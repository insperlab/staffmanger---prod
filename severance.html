<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>í‡´ì§ê¸ˆ ê´€ë¦¬ | StaffManager</title>
  <link rel="stylesheet" href="/style.css" />
  <style>
    /* â”€â”€ ê³µí†µ ë ˆì´ì•„ì›ƒ â”€â”€ */
    .page-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:24px; }
    .page-title { font-size:22px; font-weight:700; color:#1a1a2e; }

    /* â”€â”€ íƒ­ â”€â”€ */
    .tab-nav { display:flex; gap:4px; border-bottom:2px solid #e5e7eb; margin-bottom:24px; }
    .tab-btn { padding:10px 20px; border:none; background:none; font-size:14px; font-weight:500;
               color:#6b7280; cursor:pointer; border-bottom:2px solid transparent; margin-bottom:-2px; }
    .tab-btn.active { color:#4f46e5; border-bottom-color:#4f46e5; }
    .tab-panel { display:none; }
    .tab-panel.active { display:block; }

    /* â”€â”€ ì¹´ë“œ â”€â”€ */
    .card { background:#fff; border-radius:12px; border:1px solid #e5e7eb; padding:24px; margin-bottom:16px; }
    .card-title { font-size:15px; font-weight:600; color:#374151; margin-bottom:16px;
                  padding-bottom:12px; border-bottom:1px solid #f3f4f6; }

    /* â”€â”€ í¼ â”€â”€ */
    .form-grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
    .form-grid-3 { display:grid; grid-template-columns:1fr 1fr 1fr; gap:16px; }
    .form-group { display:flex; flex-direction:column; gap:6px; }
    .form-group.full { grid-column:1/-1; }
    .form-label { font-size:13px; font-weight:500; color:#374151; }
    .form-label .required { color:#ef4444; margin-left:2px; }
    .form-input, .form-select { padding:9px 12px; border:1px solid #d1d5db; border-radius:8px;
                                 font-size:14px; color:#111827; outline:none; }
    .form-input:focus, .form-select:focus { border-color:#4f46e5; box-shadow:0 0 0 3px rgba(79,70,229,.1); }
    .form-hint { font-size:12px; color:#9ca3af; }

    /* â”€â”€ í† ê¸€ â”€â”€ */
    .toggle-group { display:flex; align-items:center; gap:10px; padding:10px 14px;
                    background:#f9fafb; border-radius:8px; border:1px solid #e5e7eb; }
    .toggle { position:relative; width:40px; height:22px; }
    .toggle input { opacity:0; width:0; height:0; }
    .toggle-slider { position:absolute; inset:0; background:#d1d5db; border-radius:20px;
                     cursor:pointer; transition:.2s; }
    .toggle-slider:before { content:''; position:absolute; width:16px; height:16px; left:3px; top:3px;
                             background:#fff; border-radius:50%; transition:.2s; }
    .toggle input:checked + .toggle-slider { background:#4f46e5; }
    .toggle input:checked + .toggle-slider:before { transform:translateX(18px); }
    .toggle-label { font-size:13px; color:#374151; }

    /* â”€â”€ ë²„íŠ¼ â”€â”€ */
    .btn { padding:9px 18px; border-radius:8px; font-size:14px; font-weight:500;
           cursor:pointer; border:none; transition:.15s; }
    .btn-primary { background:#4f46e5; color:#fff; }
    .btn-primary:hover { background:#4338ca; }
    .btn-secondary { background:#f3f4f6; color:#374151; border:1px solid #d1d5db; }
    .btn-secondary:hover { background:#e5e7eb; }
    .btn-danger { background:#fee2e2; color:#dc2626; }
    .btn-danger:hover { background:#fecaca; }
    .btn-lg { padding:12px 28px; font-size:15px; }
    .btn-sm { padding:6px 12px; font-size:13px; }
    .btn-group { display:flex; gap:10px; margin-top:20px; }

    /* â”€â”€ ê²°ê³¼ ë°•ìŠ¤ â”€â”€ */
    .result-section { display:none; }
    .result-section.show { display:block; }
    .result-summary { display:grid; grid-template-columns:repeat(4,1fr); gap:12px; margin-bottom:16px; }
    .result-box { background:#f9fafb; border-radius:10px; padding:16px; text-align:center; }
    .result-box.highlight { background:#eef2ff; border:1px solid #c7d2fe; }
    .result-box.refund { background:#f0fdf4; border:1px solid #86efac; }
    .result-box .label { font-size:12px; color:#6b7280; margin-bottom:6px; }
    .result-box .value { font-size:20px; font-weight:700; color:#111827; }
    .result-box .value.green { color:#16a34a; }
    .result-box .value.purple { color:#4f46e5; }

    /* â”€â”€ ê³„ì‚° ìƒì„¸ í…Œì´ë¸” â”€â”€ */
    .calc-table { width:100%; border-collapse:collapse; font-size:14px; }
    .calc-table th { background:#f9fafb; padding:10px 14px; text-align:left;
                     font-weight:500; color:#6b7280; border-bottom:1px solid #e5e7eb; }
    .calc-table td { padding:10px 14px; border-bottom:1px solid #f3f4f6; color:#374151; }
    .calc-table tr:last-child td { border-bottom:none; }
    .calc-table .total-row td { font-weight:700; color:#111827; background:#f9fafb; }
    .calc-table .indent { padding-left:28px; color:#6b7280; }
    .calc-table .amount { text-align:right; font-variant-numeric:tabular-nums; }

    /* â”€â”€ ê²½ê³  â”€â”€ */
    .warning-box { background:#fffbeb; border:1px solid #fcd34d; border-radius:8px;
                   padding:12px 16px; margin-bottom:12px; font-size:13px; color:#92400e; }
    .warning-box.info { background:#eff6ff; border-color:#bfdbfe; color:#1d4ed8; }
    .warning-box.danger { background:#fef2f2; border-color:#fca5a5; color:#dc2626; }
    .warning-box.success { background:#f0fdf4; border-color:#86efac; color:#15803d; }

    /* â”€â”€ IRP ì ˆì„¸ ì‹œë®¬ â”€â”€ */
    .irp-sim { display:grid; grid-template-columns:1fr 1fr 1fr; gap:12px; margin-top:12px; }
    .irp-card { border-radius:10px; padding:14px; text-align:center; border:1px solid #e5e7eb; }
    .irp-card .irp-label { font-size:12px; color:#6b7280; margin-bottom:8px; }
    .irp-card .irp-tax { font-size:18px; font-weight:700; color:#374151; }
    .irp-card .irp-save { font-size:12px; color:#16a34a; margin-top:4px; }
    .irp-card.best { background:#f0fdf4; border-color:#86efac; }

    /* â”€â”€ ì§€ê¸‰ ëª©ë¡ â”€â”€ */
    .list-table { width:100%; border-collapse:collapse; font-size:14px; }
    .list-table th { background:#f9fafb; padding:11px 14px; text-align:left;
                     font-weight:500; color:#6b7280; border-bottom:2px solid #e5e7eb; }
    .list-table td { padding:11px 14px; border-bottom:1px solid #f3f4f6; color:#374151; }
    .list-table tr:hover td { background:#f9fafb; }
    .badge { display:inline-block; padding:3px 10px; border-radius:20px; font-size:12px; font-weight:500; }
    .badge-pending { background:#fef3c7; color:#d97706; }
    .badge-paid { background:#d1fae5; color:#059669; }
    .badge-overdue { background:#fee2e2; color:#dc2626; }

    /* â”€â”€ ë¹ˆ ìƒíƒœ â”€â”€ */
    .empty-state { text-align:center; padding:60px 20px; color:#9ca3af; }
    .empty-state .icon { font-size:48px; margin-bottom:12px; }
    .empty-state p { font-size:15px; }

    /* â”€â”€ ë¡œë”© â”€â”€ */
    .spinner { display:inline-block; width:18px; height:18px; border:2px solid #c7d2fe;
               border-top-color:#4f46e5; border-radius:50%; animation:spin .7s linear infinite; }
    @keyframes spin { to { transform:rotate(360deg); } }

    /* â”€â”€ ì„¹ì…˜ êµ¬ë¶„ì„  â”€â”€ */
    .section-divider { height:1px; background:#f3f4f6; margin:20px 0; }
  </style>
</head>
<body>
<!-- ì‚¬ì´ë“œë°” include -->
<div id="sidebar-placeholder"></div>

<main class="main-content" id="mainContent">
  <div class="page-header">
    <div class="page-title">ğŸ’° í‡´ì§ê¸ˆ ê´€ë¦¬</div>
  </div>

  <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
  <div class="tab-nav">
    <button class="tab-btn active" data-tab="calc">í‡´ì§ê¸ˆ ê³„ì‚°</button>
    <button class="tab-btn" data-tab="list">ì§€ê¸‰ ë‚´ì—­</button>
    <button class="tab-btn" data-tab="dc">DC ë¶€ë‹´ê¸ˆ</button>
    <button class="tab-btn" data-tab="sim">ì‹œë®¬ë ˆì´í„°</button>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       íƒ­ 1: í‡´ì§ê¸ˆ ê³„ì‚°
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="tab-panel active" id="tab-calc">

    <!-- ì…ë ¥ ì¹´ë“œ -->
    <div class="card">
      <div class="card-title">ğŸ“‹ í‡´ì§ê¸ˆ ê³„ì‚° ì •ë³´ ì…ë ¥</div>

      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">ì§ì› ì„ íƒ <span class="required">*</span></label>
          <select class="form-select" id="selEmployee">
            <option value="">-- ì§ì›ì„ ì„ íƒí•´ì£¼ì„¸ìš” --</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">í‡´ì§ì¼ <span class="required">*</span></label>
          <input type="date" class="form-input" id="retirementDate" />
          <span class="form-hint">ë§ˆì§€ë§‰ ê·¼ë¬´ì¼ ê¸°ì¤€</span>
        </div>
        <div class="form-group">
          <label class="form-label">í‡´ì§ì—°ê¸ˆ ìœ í˜•</label>
          <select class="form-select" id="selSeveranceType">
            <option value="lump_sum">í‡´ì§ê¸ˆ (ì‚¬ë‚´)</option>
            <option value="db">DBí˜• í™•ì •ê¸‰ì—¬</option>
            <option value="dc">DCí˜• í™•ì •ê¸°ì—¬</option>
            <option value="pureunssieat">í‘¸ë¥¸ì”¨ì•— (ê³µë‹¨)</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">IRP ê³„ì¢Œë²ˆí˜¸</label>
          <input type="text" class="form-input" id="irpAccount" placeholder="000-00-000000-0" />
          <span class="form-hint">2022.4.14~ ì˜ë¬´í™”</span>
        </div>
      </div>

      <div class="section-divider"></div>

      <!-- ìƒì—¬ê¸ˆ ì„¤ì • (í•µì‹¬ ì˜µì…˜) -->
      <div class="card-title">ğŸ’¡ ìƒì—¬ê¸ˆ í¬í•¨ ì„¤ì •</div>
      <div class="toggle-group" style="margin-bottom:16px;">
        <label class="toggle">
          <input type="checkbox" id="toggleBonus" checked />
          <span class="toggle-slider"></span>
        </label>
        <span class="toggle-label">í‡´ì§ê¸ˆ ê³„ì‚° ì‹œ ìƒì—¬ê¸ˆ í¬í•¨</span>
        <span class="form-hint" style="margin-left:auto;">
          â„¹ï¸ ì·¨ì—…ê·œì¹™ì— ëª…ì‹œëœ ì •ê¸°ìƒì—¬ í¬í•¨ ê¶Œì¥ (ëª…ì ˆìƒì—¬Â·ë¶ˆê·œì¹™ìƒì—¬ ì œì™¸)
        </span>
      </div>

      <div class="form-grid" id="bonusInputArea">
        <div class="form-group">
          <label class="form-label">ì—°ê°„ ìƒì—¬ê¸ˆ ì´ì•¡</label>
          <input type="number" class="form-input" id="bonusAnnualAmount"
                 placeholder="0" min="0" step="10000" />
          <span class="form-hint">ì§ì ‘ ì…ë ¥ (ë¹„ì›Œë‘ë©´ ì§ì› ì •ë³´ì˜ ìƒì—¬ê¸ˆ ì‚¬ìš©)</span>
        </div>
        <div class="form-group">
          <label class="form-label">ê³„ì‚°ì— ë°˜ì˜ë˜ëŠ” ìƒì—¬ê¸ˆ (3/12)</label>
          <input type="text" class="form-input" id="bonus3mPreview" readonly
                 style="background:#f9fafb; color:#6b7280;" value="0ì›" />
          <span class="form-hint">ì—°ê°„ ìƒì—¬ê¸ˆ Ã· 12 Ã— 3</span>
        </div>
      </div>

      <div class="btn-group">
        <button class="btn btn-primary btn-lg" id="btnPreview">
          ğŸ” í‡´ì§ê¸ˆ ë¯¸ë¦¬ë³´ê¸°
        </button>
        <button class="btn btn-secondary" id="btnReset">ì´ˆê¸°í™”</button>
      </div>
    </div>

    <!-- ê²½ê³  ì˜ì—­ -->
    <div id="warningArea"></div>

    <!-- ê²°ê³¼ ì¹´ë“œ -->
    <div class="result-section" id="resultSection">

      <!-- ìš”ì•½ -->
      <div class="result-summary">
        <div class="result-box">
          <div class="label">ì¬ì§ ê¸°ê°„</div>
          <div class="value" id="res-servicePeriod">-</div>
        </div>
        <div class="result-box highlight">
          <div class="label">í‡´ì§ê¸ˆ (ì„¸ì „)</div>
          <div class="value purple" id="res-severancePay">-</div>
        </div>
        <div class="result-box">
          <div class="label">í‡´ì§ì†Œë“ì„¸ í•©ê³„</div>
          <div class="value" id="res-totalTax">-</div>
        </div>
        <div class="result-box refund">
          <div class="label">ì‹¤ ì§€ê¸‰ì•¡</div>
          <div class="value green" id="res-netPay">-</div>
        </div>
      </div>

      <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">

        <!-- í‰ê· ì„ê¸ˆ ìƒì„¸ -->
        <div class="card">
          <div class="card-title">ğŸ“Š í‰ê· ì„ê¸ˆ ê³„ì‚° ìƒì„¸</div>
          <table class="calc-table">
            <thead>
              <tr><th>í•­ëª©</th><th class="amount">ê¸ˆì•¡</th></tr>
            </thead>
            <tbody>
              <tr><td>ì‚°ì • ê¸°ê°„</td><td class="amount" id="d-period">-</td></tr>
              <tr><td>ê¸°ë³¸ê¸‰ (3ê°œì›”)</td><td class="amount" id="d-basePay">-</td></tr>
              <tr><td>ì œìˆ˜ë‹¹ (3ê°œì›”)</td><td class="amount" id="d-allowance">-</td></tr>
              <tr><td class="indent">â”” ì•¼ê°„Â·ì—°ì¥Â·íœ´ì¼ìˆ˜ë‹¹ í¬í•¨</td><td></td></tr>
              <tr><td>ìƒì—¬ê¸ˆ (ì—°ê°„ Ã— 3/12)</td><td class="amount" id="d-bonus">-</td></tr>
              <tr><td>ì—°ì°¨ë¯¸ì‚¬ìš©ìˆ˜ë‹¹</td><td class="amount" id="d-unusedLeave">-</td></tr>
              <tr class="total-row"><td>3ê°œì›” ì„ê¸ˆ í•©ê³„</td><td class="amount" id="d-totalWage">-</td></tr>
              <tr><td>ì‚°ì • ì¼ìˆ˜</td><td class="amount" id="d-days">-</td></tr>
              <tr><td>1ì¼ í‰ê· ì„ê¸ˆ</td><td class="amount" id="d-dailyAvg">-</td></tr>
              <tr><td>1ì¼ í†µìƒì„ê¸ˆ</td><td class="amount" id="d-dailyOrd">-</td></tr>
              <tr class="total-row"><td>ì ìš© ì¼ê¸‰ <span id="d-whichWage" style="font-size:11px; color:#6b7280;"></span></td><td class="amount" id="d-appliedWage">-</td></tr>
            </tbody>
          </table>
        </div>

        <!-- í‡´ì§ì†Œë“ì„¸ ìƒì„¸ -->
        <div class="card">
          <div class="card-title">ğŸ§¾ í‡´ì§ì†Œë“ì„¸ ê³„ì‚° ìƒì„¸</div>
          <table class="calc-table">
            <thead>
              <tr><th>ë‹¨ê³„</th><th class="amount">ê¸ˆì•¡</th></tr>
            </thead>
            <tbody>
              <tr><td>STEP 1. í‡´ì§ì†Œë“ê¸ˆì•¡</td><td class="amount" id="t-retirementIncome">-</td></tr>
              <tr><td>STEP 2. (-) ê·¼ì†ì—°ìˆ˜ê³µì œ</td><td class="amount" id="t-serviceDeduction">-</td></tr>
              <tr><td>STEP 3. í™˜ì‚°ê¸‰ì—¬</td><td class="amount" id="t-convertedSalary">-</td></tr>
              <tr><td>STEP 4. (-) í™˜ì‚°ê¸‰ì—¬ê³µì œ</td><td class="amount" id="t-convertedDeduction">-</td></tr>
              <tr><td>STEP 5. ê³¼ì„¸í‘œì¤€</td><td class="amount" id="t-taxBase">-</td></tr>
              <tr><td>STEP 6. í™˜ì‚°ì‚°ì¶œì„¸ì•¡</td><td class="amount" id="t-convertedTax">-</td></tr>
              <tr><td>STEP 7. í‡´ì§ì†Œë“ì„¸</td><td class="amount" id="t-incomeTax">-</td></tr>
              <tr><td>STEP 8. ì§€ë°©ì†Œë“ì„¸ (Ã—10%)</td><td class="amount" id="t-localTax">-</td></tr>
              <tr class="total-row"><td>í•©ê³„ ì„¸ì•¡</td><td class="amount" id="t-totalTax">-</td></tr>
            </tbody>
          </table>

          <!-- IRP ì ˆì„¸ -->
          <div style="margin-top:16px;">
            <div style="font-size:13px; font-weight:600; color:#374151; margin-bottom:8px;">
              ğŸ’¡ IRP ì—°ê¸ˆ ìˆ˜ë ¹ ì‹œ ì ˆì„¸ ì‹œë®¬ë ˆì´ì…˜
            </div>
            <div class="irp-sim">
              <div class="irp-card">
                <div class="irp-label">ì¼ì‹œê¸ˆ ìˆ˜ë ¹</div>
                <div class="irp-tax" id="irp-lumpsum">-</div>
                <div class="irp-save">ê¸°ì¤€</div>
              </div>
              <div class="irp-card">
                <div class="irp-label">ì—°ê¸ˆ (10ë…„ ì´ë‚´)</div>
                <div class="irp-tax" id="irp-10">-</div>
                <div class="irp-save" id="irp-10-save">-</div>
              </div>
              <div class="irp-card best">
                <div class="irp-label">ì—°ê¸ˆ (10ë…„ ì´ˆê³¼) â­</div>
                <div class="irp-tax" id="irp-over10">-</div>
                <div class="irp-save" id="irp-over10-save">-</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ì§€ê¸‰ ê¸°í•œ -->
      <div class="warning-box info" id="paymentDueBox"></div>

      <!-- í™•ì • ë²„íŠ¼ -->
      <div class="btn-group">
        <button class="btn btn-primary btn-lg" id="btnConfirm">
          âœ… í‡´ì§ê¸ˆ í™•ì • ë° ì €ì¥
        </button>
        <button class="btn btn-secondary" id="btnPrint">ğŸ–¨ï¸ ì¸ì‡„</button>
      </div>
    </div>
  </div><!-- /tab-calc -->

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       íƒ­ 2: ì§€ê¸‰ ë‚´ì—­
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="tab-panel" id="tab-list">
    <div class="card">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
        <div class="card-title" style="margin-bottom:0; border-bottom:none;">í‡´ì§ê¸ˆ ì§€ê¸‰ ë‚´ì—­</div>
        <div style="display:flex; gap:8px; align-items:center;">
          <select class="form-select" id="filterYear" style="width:120px;">
            <option value="">ì „ì²´ ì—°ë„</option>
          </select>
          <select class="form-select" id="filterStatus" style="width:120px;">
            <option value="">ì „ì²´ ìƒíƒœ</option>
            <option value="pending">ë¯¸ì§€ê¸‰</option>
            <option value="paid">ì§€ê¸‰ì™„ë£Œ</option>
            <option value="overdue">ê¸°í•œì´ˆê³¼</option>
          </select>
        </div>
      </div>
      <div id="listTableArea">
        <div class="empty-state">
          <div class="icon">ğŸ’¼</div>
          <p>í‡´ì§ê¸ˆ ì§€ê¸‰ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       íƒ­ 3: DC ë¶€ë‹´ê¸ˆ
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="tab-panel" id="tab-dc">
    <div class="card">
      <div class="card-title">ğŸ“… DCí˜• ì—°ê°„ ë¶€ë‹´ê¸ˆ í˜„í™©</div>
      <div class="warning-box info">
        DCí˜•(í™•ì •ê¸°ì—¬í˜•) í‡´ì§ì—°ê¸ˆì€ ë§¤ë…„ <strong>ì—°ê°„ ì„ê¸ˆ ì´ì•¡ Ã· 12 ì´ìƒ</strong>ì„ ê¸ˆìœµê¸°ê´€ì— ë‚©ë¶€í•´ì•¼ í•©ë‹ˆë‹¤.
        ë¯¸ë‚© ì‹œ ê³¼íƒœë£Œ ë° ì´ìê°€ ë°œìƒí•©ë‹ˆë‹¤.
      </div>
      <div id="dcTableArea">
        <div class="empty-state">
          <div class="icon">ğŸ“Š</div>
          <p>DCí˜• ë¶€ë‹´ê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       íƒ­ 4: ì‹œë®¬ë ˆì´í„°
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="tab-panel" id="tab-sim">
    <div class="card">
      <div class="card-title">ğŸ§® í‡´ì§ê¸ˆ ê°„í¸ ì‹œë®¬ë ˆì´í„°</div>
      <p style="font-size:13px; color:#6b7280; margin-bottom:16px;">
        ì§ì› ë“±ë¡ ì—†ì´ ì›”ê¸‰Â·ê·¼ì†ì—°ìˆ˜ë§Œ ì…ë ¥í•´ì„œ í‡´ì§ê¸ˆì„ ë¹ ë¥´ê²Œ ê³„ì‚°í•´ë³´ì„¸ìš”.
      </p>

      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">ì›” ê¸°ë³¸ê¸‰</label>
          <input type="number" class="form-input" id="sim-monthly" placeholder="3000000" />
        </div>
        <div class="form-group">
          <label class="form-label">ì›” ê³ ì •ìˆ˜ë‹¹ (ì‹ëŒ€Â·êµí†µë¹„ ë“±)</label>
          <input type="number" class="form-input" id="sim-allowance" placeholder="200000" />
        </div>
        <div class="form-group">
          <label class="form-label">ì—°ê°„ ìƒì—¬ê¸ˆ</label>
          <input type="number" class="form-input" id="sim-bonus" placeholder="6000000" />
        </div>
        <div class="form-group">
          <label class="form-label">ê·¼ì†ì—°ìˆ˜ (ë…„)</label>
          <input type="number" class="form-input" id="sim-years" placeholder="3" min="1" max="50" />
        </div>
      </div>

      <button class="btn btn-primary" style="margin-top:12px;" id="btnSimCalc">ê³„ì‚°í•˜ê¸°</button>

      <div id="simResult" style="display:none; margin-top:20px;">
        <div class="result-summary" style="grid-template-columns:repeat(3,1fr);">
          <div class="result-box highlight">
            <div class="label">í‡´ì§ê¸ˆ (ì„¸ì „)</div>
            <div class="value purple" id="sim-severancePay">-</div>
          </div>
          <div class="result-box">
            <div class="label">í‡´ì§ì†Œë“ì„¸</div>
            <div class="value" id="sim-tax">-</div>
          </div>
          <div class="result-box refund">
            <div class="label">ì‹¤ ì§€ê¸‰ ì˜ˆìƒì•¡</div>
            <div class="value green" id="sim-net">-</div>
          </div>
        </div>
        <div class="warning-box info" style="margin-top:12px; font-size:12px;">
          ğŸ“Œ ì´ ê³„ì‚°ì€ ë‹¨ìˆœ ì°¸ê³ ìš©ì…ë‹ˆë‹¤. ì‹¤ì œ í‡´ì§ê¸ˆì€ ì·¨ì—…ê·œì¹™Â·ê·¼ë¡œê³„ì•½ì„œì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
      </div>
    </div>
  </div>

</main><!-- /main-content -->

<script>
/* ============================================================
   ì „ì—­ ë³€ìˆ˜ (ë‹¤ë¥¸ í˜ì´ì§€ì™€ ë™ì¼í•œ íŒ¨í„´)
============================================================ */
var authToken = null;

/* ============================================================
   í˜ì´ì§€ ì§„ì… ì´ˆê¸°í™”
============================================================ */
window.addEventListener('DOMContentLoaded', async function() {
  // 1. ì¸ì¦ ì²´í¬ (salary.htmlê³¼ ë™ì¼: authToken + userInfo ë‘˜ ë‹¤ í•„ìš”)
  authToken = localStorage.getItem('authToken');
  var ui = localStorage.getItem('userInfo');
  if (!authToken || !ui) { window.location.href = '/login.html'; return; }
  try { JSON.parse(ui); } catch(e) { window.location.href = '/login.html'; return; }

  // 2. ì§ì› ëª©ë¡ ë¡œë“œ
  await loadEmployees();

  // 3. ì—°ë„ í•„í„° ì´ˆê¸°í™”
  const sel = document.getElementById('filterYear');
  const currentYear = new Date().getFullYear();
  for (let y = currentYear; y >= currentYear - 5; y--) {
    const opt = document.createElement('option');
    opt.value = y; opt.textContent = y + 'ë…„';
    sel.appendChild(opt);
  }

  // 4. ì‚¬ì´ë“œë°” ë¡œë“œ
  fetch('/sidebar.html').then(r => r.text()).then(h => {
    document.getElementById('sidebar-placeholder').innerHTML = h;
  }).catch(() => {});
});

/* ============================================================
   ê³µí†µ ìœ í‹¸
============================================================ */
// API POST í˜¸ì¶œ
const API = (path, body) => fetch(`/.netlify/functions/${path}`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json',
             Authorization: `Bearer ${authToken}` },
  body: JSON.stringify(body),
}).then(r => r.json());

// API GET í˜¸ì¶œ
const GET = (path) => fetch(`/.netlify/functions/${path}`, {
  headers: { Authorization: `Bearer ${authToken}` },
}).then(r => r.json());

const won = n => (Number(n) || 0).toLocaleString() + 'ì›';
const wonShort = n => {
  const v = Number(n) || 0;
  if (v >= 100000000) return (v / 100000000).toFixed(1) + 'ì–µì›';
  if (v >= 10000) return Math.floor(v / 10000) + 'ë§Œì›';
  return v.toLocaleString() + 'ì›';
};

/* ============================================================
   íƒ­ ì „í™˜
============================================================ */
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(`tab-${btn.dataset.tab}`).classList.add('active');
    if (btn.dataset.tab === 'list') loadList();
    if (btn.dataset.tab === 'dc') loadDc();
  });
});

/* ============================================================
   íƒ­1: í‡´ì§ê¸ˆ ê³„ì‚°
============================================================ */

// ì§ì› ëª©ë¡ ë¡œë“œ
async function loadEmployees() {
  const sel = document.getElementById('selEmployee');
  try {
    const res = await GET('employees-list');
    if (!res.success) return;
    res.data.forEach(emp => {
      const opt = document.createElement('option');
      opt.value = emp.id;
      opt.dataset.hire = emp.hire_date || '';
      opt.dataset.bonus = emp.bonus_annual_amount || 0;
      opt.dataset.irp = emp.irp_account || '';
      opt.textContent = `${emp.name} (ì…ì‚¬: ${emp.hire_date || 'ë¯¸ë“±ë¡'})`;
      sel.appendChild(opt);
    });
  } catch(e) { console.error('ì§ì› ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', e); }
}

// ì§ì› ì„ íƒ ì‹œ ìë™ ì±„ìš°ê¸°
document.getElementById('selEmployee').addEventListener('change', function() {
  const opt = this.options[this.selectedIndex];
  if (opt.dataset.irp) document.getElementById('irpAccount').value = opt.dataset.irp;
  if (opt.dataset.bonus) document.getElementById('bonusAnnualAmount').value = opt.dataset.bonus;
  updateBonus3mPreview();
});

// ìƒì—¬ê¸ˆ í† ê¸€
document.getElementById('toggleBonus').addEventListener('change', function() {
  document.getElementById('bonusInputArea').style.display = this.checked ? 'grid' : 'none';
});

// ì—°ê°„ ìƒì—¬ê¸ˆ â†’ 3/12 ë¯¸ë¦¬ë³´ê¸°
function updateBonus3mPreview() {
  const annual = Number(document.getElementById('bonusAnnualAmount').value) || 0;
  const bonus3m = Math.floor(annual * 3 / 12);
  document.getElementById('bonus3mPreview').value = bonus3m.toLocaleString() + 'ì›';
}
document.getElementById('bonusAnnualAmount').addEventListener('input', updateBonus3mPreview);

// í‡´ì§ê¸ˆ ë¯¸ë¦¬ë³´ê¸°
var previewData = null;

document.getElementById('btnPreview').addEventListener('click', async () => {
  const employeeId = document.getElementById('selEmployee').value;
  const retirementDate = document.getElementById('retirementDate').value;
  if (!employeeId || !retirementDate) {
    alert('ì§ì›ê³¼ í‡´ì§ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
    return;
  }

  const btn = document.getElementById('btnPreview');
  btn.innerHTML = '<span class="spinner"></span> ê³„ì‚° ì¤‘...';
  btn.disabled = true;

  try {
    const res = await API('calculate-severance', {
      employeeId,
      retirementDate,
      severanceType: document.getElementById('selSeveranceType').value,
      includeBonus: document.getElementById('toggleBonus').checked,
      bonusAnnualAmount: Number(document.getElementById('bonusAnnualAmount').value) || 0,
      irpAccount: document.getElementById('irpAccount').value,
      preview: true,
    });

    if (!res.success) { showWarning(res.error, 'danger'); return; }
    previewData = res.data;
    renderResult(res.data);
  } catch (e) {
    showWarning('ê³„ì‚° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'danger');
  } finally {
    btn.innerHTML = 'ğŸ” í‡´ì§ê¸ˆ ë¯¸ë¦¬ë³´ê¸°';
    btn.disabled = false;
  }
});

// ê²°ê³¼ ë Œë”ë§
function renderResult(d) {
  document.getElementById('res-servicePeriod').textContent = d.serviceYearsDisplay;
  document.getElementById('res-severancePay').textContent = won(d.severancePay);
  document.getElementById('res-totalTax').textContent = won(d.tax.totalTax);
  document.getElementById('res-netPay').textContent = won(d.netSeverancePay);

  const a = d.avgWage;
  document.getElementById('d-period').textContent =
    `${a.periodStart} ~ ${a.periodEnd} (${a.periodDays}ì¼)`;
  document.getElementById('d-basePay').textContent = won(a.basePay3m);
  document.getElementById('d-allowance').textContent = won(a.allowance3m);
  document.getElementById('d-bonus').textContent =
    a.bonusIncludeOption ? won(a.bonus3m) : '0ì› (ì œì™¸)';
  document.getElementById('d-unusedLeave').textContent = won(a.unusedLeavePay);
  document.getElementById('d-totalWage').textContent = won(a.totalWage3m);
  document.getElementById('d-days').textContent = a.periodDays + 'ì¼';
  document.getElementById('d-dailyAvg').textContent = won(a.dailyAverageWage);
  document.getElementById('d-dailyOrd').textContent = won(a.dailyOrdinaryWage);
  document.getElementById('d-appliedWage').textContent = won(a.appliedDailyWage);
  document.getElementById('d-whichWage').textContent =
    a.usedOrdinary ? '(í†µìƒì„ê¸ˆ ì ìš©)' : '(í‰ê· ì„ê¸ˆ ì ìš©)';

  const t = d.tax;
  document.getElementById('t-retirementIncome').textContent = won(t.retirementIncome || d.severancePay);
  document.getElementById('t-serviceDeduction').textContent = '-' + won(t.serviceYearsDeduction);
  document.getElementById('t-convertedSalary').textContent = won(t.convertedSalary);
  document.getElementById('t-convertedDeduction').textContent = '-' + won(t.convertedDeduction);
  document.getElementById('t-taxBase').textContent = won(t.taxBase);
  document.getElementById('t-convertedTax').textContent = won(t.convertedTax || 0);
  document.getElementById('t-incomeTax').textContent = won(t.incomeTax);
  document.getElementById('t-localTax').textContent = won(t.localIncomeTax);
  document.getElementById('t-totalTax').textContent = won(t.totalTax);

  const irp = d.irpBenefit;
  document.getElementById('irp-lumpsum').textContent = won(irp.lumpSum);
  document.getElementById('irp-10').textContent = won(irp.annuityWithin10);
  document.getElementById('irp-10-save').textContent = `ì ˆì„¸ ${won(irp.savingWithin10)}`;
  document.getElementById('irp-over10').textContent = won(irp.annuityOver10);
  document.getElementById('irp-over10-save').textContent = `ì ˆì„¸ ${won(irp.savingOver10)}`;

  document.getElementById('paymentDueBox').innerHTML =
    `ğŸ“… <strong>ì§€ê¸‰ ê¸°í•œ: ${d.paymentDueDate}</strong> (í‡´ì§ì¼ë¡œë¶€í„° 14ì¼ ì´ë‚´)
     â€” ê¸°í•œ ì´ˆê³¼ ì‹œ ì—° 20% ì§€ì—°ì´ì ë°œìƒ`;

  const warningArea = document.getElementById('warningArea');
  warningArea.innerHTML = '';
  (d.warnings || []).forEach(w => {
    const cls = w.startsWith('ğŸš¨') ? 'danger' : w.startsWith('â„¹ï¸') ? 'info' : '';
    warningArea.innerHTML += `<div class="warning-box ${cls}">${w}</div>`;
  });

  document.getElementById('resultSection').classList.add('show');
  document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// ê²½ê³  í‘œì‹œ
function showWarning(msg, type = '') {
  document.getElementById('warningArea').innerHTML =
    `<div class="warning-box ${type}">${msg}</div>`;
}

// í™•ì • ì €ì¥
document.getElementById('btnConfirm').addEventListener('click', async () => {
  if (!previewData) return;
  if (!confirm(`${previewData.employeeName}ë‹˜ì˜ í‡´ì§ê¸ˆ ${won(previewData.netSeverancePay)}ì„ í™•ì • ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;

  const btn = document.getElementById('btnConfirm');
  btn.innerHTML = '<span class="spinner"></span> ì €ì¥ ì¤‘...';
  btn.disabled = true;

  try {
    const res = await API('calculate-severance', {
      employeeId: document.getElementById('selEmployee').value,
      retirementDate: document.getElementById('retirementDate').value,
      severanceType: document.getElementById('selSeveranceType').value,
      includeBonus: document.getElementById('toggleBonus').checked,
      bonusAnnualAmount: Number(document.getElementById('bonusAnnualAmount').value) || 0,
      irpAccount: document.getElementById('irpAccount').value,
      preview: false,
    });

    if (res.success) {
      alert('âœ… í‡´ì§ê¸ˆì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ì§€ê¸‰ ë‚´ì—­ íƒ­ì—ì„œ í™•ì¸í•˜ì„¸ìš”.');
      document.querySelector('[data-tab="list"]').click();
    } else {
      alert('ì €ì¥ ì‹¤íŒ¨: ' + res.error);
    }
  } finally {
    btn.innerHTML = 'âœ… í‡´ì§ê¸ˆ í™•ì • ë° ì €ì¥';
    btn.disabled = false;
  }
});

// ì´ˆê¸°í™”
document.getElementById('btnReset').addEventListener('click', () => {
  document.getElementById('selEmployee').value = '';
  document.getElementById('retirementDate').value = '';
  document.getElementById('bonusAnnualAmount').value = '';
  document.getElementById('irpAccount').value = '';
  document.getElementById('resultSection').classList.remove('show');
  document.getElementById('warningArea').innerHTML = '';
  previewData = null;
});

document.getElementById('btnPrint').addEventListener('click', () => window.print());

/* ============================================================
   íƒ­2: ì§€ê¸‰ ë‚´ì—­
============================================================ */
async function loadList() {
  const area = document.getElementById('listTableArea');
  area.innerHTML = '<div style="text-align:center; padding:20px;"><span class="spinner"></span></div>';

  try {
    const res = await fetch('/.netlify/functions/severance-list', {
      headers: { Authorization: `Bearer ${authToken}` },
    }).then(r => r.json());

    if (!res.success || !res.data?.length) {
      area.innerHTML = `<div class="empty-state"><div class="icon">ğŸ’¼</div><p>í‡´ì§ê¸ˆ ì§€ê¸‰ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>`;
      return;
    }

    const rows = res.data.map(r => {
      const badge = r.status === 'paid'
        ? '<span class="badge badge-paid">ì§€ê¸‰ì™„ë£Œ</span>'
        : r.status === 'overdue'
        ? '<span class="badge badge-overdue">ê¸°í•œì´ˆê³¼</span>'
        : '<span class="badge badge-pending">ë¯¸ì§€ê¸‰</span>';
      return `
        <tr>
          <td>${r.employee_name || '-'}</td>
          <td>${r.retirement_date}</td>
          <td>${r.service_days}ì¼</td>
          <td style="text-align:right;">${won(r.severance_pay)}</td>
          <td style="text-align:right;">${won(r.total_tax)}</td>
          <td style="text-align:right; font-weight:600;">${won(r.net_severance_pay)}</td>
          <td>${r.payment_due_date}</td>
          <td>${badge}</td>
        </tr>`;
    }).join('');

    area.innerHTML = `
      <table class="list-table">
        <thead>
          <tr>
            <th>ì§ì›ëª…</th><th>í‡´ì§ì¼</th><th>ì¬ì§ê¸°ê°„</th>
            <th style="text-align:right;">í‡´ì§ê¸ˆ(ì„¸ì „)</th>
            <th style="text-align:right;">ì„¸ì•¡</th>
            <th style="text-align:right;">ì‹¤ì§€ê¸‰ì•¡</th>
            <th>ì§€ê¸‰ê¸°í•œ</th><th>ìƒíƒœ</th>
          </tr>
        </thead>
        <tbody>${rows}</tbody>
      </table>`;
  } catch {
    area.innerHTML = '<div class="warning-box danger">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
  }
}

/* ============================================================
   íƒ­3: DC ë¶€ë‹´ê¸ˆ
============================================================ */
async function loadDc() {
  document.getElementById('dcTableArea').innerHTML =
    '<div class="empty-state"><div class="icon">ğŸ“Š</div><p>DCí˜• ë¶€ë‹´ê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>';
}

/* ============================================================
   íƒ­4: ì‹œë®¬ë ˆì´í„°
============================================================ */
document.getElementById('btnSimCalc').addEventListener('click', () => {
  const monthly = Number(document.getElementById('sim-monthly').value) || 0;
  const allowance = Number(document.getElementById('sim-allowance').value) || 0;
  const bonusAnnual = Number(document.getElementById('sim-bonus').value) || 0;
  const years = Number(document.getElementById('sim-years').value) || 0;

  if (!monthly || !years) { alert('ì›” ê¸°ë³¸ê¸‰ê³¼ ê·¼ì†ì—°ìˆ˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
  if (years < 1) { alert('í‡´ì§ê¸ˆì€ 1ë…„ ì´ìƒ ê·¼ë¬´ ì‹œ ë°œìƒí•©ë‹ˆë‹¤.'); return; }

  // 3ê°œì›” ì„ê¸ˆ ì´ì•¡
  const wage3m = (monthly + allowance) * 3 + Math.floor(bonusAnnual * 3 / 12);
  const serviceDays = Math.round(years * 365);
  const dailyAvg = Math.floor(wage3m / 92);
  const severancePay = Math.floor(dailyAvg * 30 * (serviceDays / 365));
  const tax = calcSeveranceTaxInline(severancePay, years);
  const netPay = severancePay - tax;

  document.getElementById('sim-severancePay').textContent = won(severancePay);
  document.getElementById('sim-tax').textContent = won(tax);
  document.getElementById('sim-net').textContent = won(netPay);
  document.getElementById('simResult').style.display = 'block';
});

// ì‹œë®¬ë ˆì´í„° ì„¸ê¸ˆ ê³„ì‚° (í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ)
function calcSeveranceTaxInline(severancePay, years) {
  const roundYears = Math.ceil(years);
  // ê·¼ì†ì—°ìˆ˜ê³µì œ
  let syd;
  if (roundYears <= 5) syd = roundYears * 1000000;
  else if (roundYears <= 10) syd = 5000000 + (roundYears - 5) * 2000000;
  else if (roundYears <= 20) syd = 15000000 + (roundYears - 10) * 2500000;
  else syd = 40000000 + (roundYears - 20) * 3000000;

  const converted = Math.floor(Math.max(severancePay - syd, 0) * 12 / roundYears);

  // í™˜ì‚°ê¸‰ì—¬ê³µì œ
  let cd;
  if (converted <= 8000000) cd = converted;
  else if (converted <= 70000000) cd = 8000000 + Math.floor((converted - 8000000) * 0.6);
  else if (converted <= 100000000) cd = 45200000 + Math.floor((converted - 70000000) * 0.55);
  else if (converted <= 300000000) cd = 61700000 + Math.floor((converted - 100000000) * 0.45);
  else cd = 151700000 + Math.floor((converted - 300000000) * 0.35);

  const taxBase = Math.max(converted - cd, 0);

  // ì„¸ìœ¨ êµ¬ê°„
  let convertedTax;
  if (taxBase <= 14000000) convertedTax = Math.floor(taxBase * 0.06);
  else if (taxBase <= 50000000) convertedTax = Math.floor(taxBase * 0.15 - 1260000);
  else if (taxBase <= 88000000) convertedTax = Math.floor(taxBase * 0.24 - 5760000);
  else if (taxBase <= 150000000) convertedTax = Math.floor(taxBase * 0.35 - 15440000);
  else convertedTax = Math.floor(taxBase * 0.38 - 19940000);

  const incomeTax = Math.floor(convertedTax * roundYears / 12);
  return incomeTax + Math.floor(incomeTax * 0.1);
}
</script>
</body>
</html>
