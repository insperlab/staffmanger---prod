<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì§ì› ìƒì„¸ - StaffManager</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Roboto',sans-serif;background:#f5f7fa;min-height:100vh}.navbar{background:#fff;box-shadow:0 2px 4px rgba(0,0,0,.1);padding:0 30px;height:70px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:100}.navbar-brand{display:flex;align-items:center;gap:12px;font-size:24px;font-weight:700;color:#667eea;text-decoration:none}.navbar-menu{display:flex;gap:30px;align-items:center}.navbar-menu a{text-decoration:none;color:#666;font-weight:500;transition:color .3s}.navbar-menu a:hover,.navbar-menu a.active{color:#667eea}.container{max-width:1200px;margin:0 auto;padding:30px}.breadcrumb{margin-bottom:20px;font-size:14px;color:#999}.breadcrumb a{color:#667eea;text-decoration:none}.profile-header{background:#fff;border-radius:12px;padding:30px;box-shadow:0 2px 8px rgba(0,0,0,.08);margin-bottom:24px;display:flex;justify-content:space-between;align-items:center}.profile-left{display:flex;align-items:center;gap:24px}.profile-avatar{width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;align-items:center;justify-content:center;font-size:32px;color:#fff;font-weight:700}.profile-name{font-size:28px;font-weight:700;color:#333;margin-bottom:4px}.profile-meta{font-size:14px;color:#999}.profile-meta span{margin-right:16px}.status-badge{display:inline-block;padding:4px 14px;border-radius:12px;font-size:13px;font-weight:600}.status-active{background:#d4edda;color:#155724}.status-on_leave{background:#fff3cd;color:#856404}.status-resigned{background:#f8d7da;color:#721c24}.profile-actions{display:flex;gap:10px}.btn{padding:10px 20px;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;border:none;transition:all .3s;text-decoration:none;display:inline-flex;align-items:center;gap:6px}.btn-primary{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.btn-primary:hover{opacity:.9}.btn-outline{background:#fff;color:#667eea;border:2px solid #667eea}.btn-outline:hover{background:#f5f7fa}.tabs{background:#fff;border-radius:12px 12px 0 0;box-shadow:0 2px 8px rgba(0,0,0,.08);display:flex;border-bottom:2px solid #e0e0e0;overflow-x:auto}.tab{padding:16px 28px;font-size:15px;font-weight:500;color:#999;cursor:pointer;border-bottom:3px solid transparent;margin-bottom:-2px;white-space:nowrap;transition:all .2s}.tab:hover{color:#667eea}.tab.active{color:#667eea;border-bottom-color:#667eea;font-weight:600}.tab-content{background:#fff;border-radius:0 0 12px 12px;padding:30px;box-shadow:0 2px 8px rgba(0,0,0,.08);display:none}.tab-content.active{display:block}.info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:24px}.info-group{margin-bottom:8px}.info-label{font-size:13px;color:#999;margin-bottom:4px}.info-value{font-size:15px;color:#333;font-weight:500}.info-value.highlight{color:#667eea;font-weight:700;font-size:18px}.section-divider{border:none;border-top:1px solid #eee;margin:24px 0}.section-subtitle{font-size:17px;font-weight:600;color:#333;margin-bottom:16px;padding-left:12px;border-left:4px solid #667eea}.contract-list{list-style:none}.contract-item{padding:16px;border:1px solid #eee;border-radius:8px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center}.contract-item:hover{background:#f8f9fa}.contract-type{font-weight:600;color:#333}.contract-date{font-size:13px;color:#999}.contract-status{font-size:12px;padding:3px 10px;border-radius:10px;font-weight:600}.contract-signed{background:#d4edda;color:#155724}.contract-pending{background:#fff3cd;color:#856404}.contract-sent{background:#d1ecf1;color:#0c5460}.loading{text-align:center;padding:80px 20px}.spinner{border:4px solid #f3f3f3;border-top:4px solid #667eea;border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite;margin:0 auto 20px}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:1000;justify-content:center;align-items:center;padding:20px}.modal-overlay.show{display:flex}.modal{background:#fff;border-radius:16px;width:100%;max-width:560px;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.2)}.modal-header{padding:24px 28px 0;display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.modal-title{font-size:20px;font-weight:700;color:#333}.modal-close{background:none;border:none;font-size:24px;color:#999;cursor:pointer;padding:4px;line-height:1}.modal-close:hover{color:#333}.modal-body{padding:0 28px 28px}.form-section{margin-bottom:24px}.form-section-title{font-size:13px;font-weight:700;color:#667eea;text-transform:uppercase;letter-spacing:.5px;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid #eee}.form-row{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:14px}.form-row.full{grid-template-columns:1fr}.form-group label{display:block;font-size:13px;font-weight:600;color:#555;margin-bottom:6px}.form-group input,.form-group select{width:100%;padding:10px 14px;border:2px solid #e0e0e0;border-radius:8px;font-size:14px;color:#333;background:#fff;transition:border-color .2s}.form-group input:focus,.form-group select:focus{outline:none;border-color:#667eea}.modal-footer{padding:20px 28px;border-top:1px solid #eee;display:flex;gap:10px;justify-content:flex-end}.btn-save{padding:12px 28px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:8px;font-size:15px;font-weight:600;cursor:pointer}.btn-save:disabled{opacity:.5;cursor:not-allowed}.btn-cancel{padding:12px 24px;background:#f5f7fa;color:#666;border:2px solid #e0e0e0;border-radius:8px;font-size:15px;font-weight:600;cursor:pointer}.save-result{margin:0 28px 16px;padding:12px 16px;border-radius:8px;font-size:14px;display:none}.save-result.success{background:#d4edda;color:#155724;display:block}.save-result.error{background:#f8d7da;color:#721c24;display:block}
@media(max-width:768px){.container{padding:15px}.profile-header{flex-direction:column;gap:20px;align-items:flex-start}.info-grid{grid-template-columns:1fr}.tab{padding:12px 16px;font-size:13px}.form-row{grid-template-columns:1fr}}
</style>
</head>
<body>
<nav class="navbar">
  <a href="/dashboard.html" class="navbar-brand"><span>ğŸ¯</span><span>StaffManager</span></a>
  <div class="navbar-menu">
    <a href="/dashboard.html">ëŒ€ì‹œë³´ë“œ</a>
    <a href="/employees.html" class="active">ì§ì› ê´€ë¦¬</a>
    <a href="/attendances.html">ì¶œí‡´ê·¼ ê´€ë¦¬</a>
    <a href="/calendar.html">íœ´ê°€ ê´€ë¦¬</a>
    <a href="/salary.html">ê¸‰ì—¬ ê´€ë¦¬</a>
    <a href="/contracts.html">ê³„ì•½ ê´€ë¦¬</a>
    <a href="/settings.html">ì„¤ì •</a>
  </div>
</nav>
<div class="container">
  <div class="breadcrumb"><a href="/employees.html">ì§ì› ê´€ë¦¬</a> &gt; <span id="breadcrumbName">ì§ì› ìƒì„¸</span></div>
  <div id="loadingState" class="loading"><div class="spinner"></div><p style="color:#999">ì§ì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>
  <div id="mainContent" style="display:none">
    <div class="profile-header">
      <div class="profile-left">
        <div class="profile-avatar" id="avatar"></div>
        <div>
          <div class="profile-name" id="empName"></div>
          <div class="profile-meta"><span id="empDept"></span><span id="empPosition"></span><span id="empBiz"></span></div>
          <div style="margin-top:8px"><span class="status-badge" id="empStatus"></span></div>
        </div>
      </div>
      <div class="profile-actions">
        <a href="/contracts.html" class="btn btn-outline">ğŸ“„ ê³„ì•½ì„œ ë°œì†¡</a>
        <button class="btn btn-primary" onclick="openEditModal()">âœï¸ ì •ë³´ ìˆ˜ì •</button>
      </div>
    </div>
    <div class="tabs">
      <div class="tab active" data-tab="basic" onclick="switchTab('basic')">ê¸°ë³¸ ì •ë³´</div>
      <div class="tab" data-tab="work" onclick="switchTab('work')">ê·¼ë¬´ ì •ë³´</div>
      <div class="tab" data-tab="salary" onclick="switchTab('salary')">ê¸‰ì—¬ ì •ë³´</div>
      <div class="tab" data-tab="contract" onclick="switchTab('contract')">ê³„ì•½ ì •ë³´</div>
    </div>
    <div class="tab-content active" id="tab-basic">
      <div class="section-subtitle">ì¸ì  ì‚¬í•­</div>
      <div class="info-grid">
        <div class="info-group"><div class="info-label">ì´ë¦„</div><div class="info-value" id="infoName">-</div></div>
        <div class="info-group"><div class="info-label">ì´ë©”ì¼</div><div class="info-value" id="infoEmail">-</div></div>
        <div class="info-group"><div class="info-label">ì „í™”ë²ˆí˜¸</div><div class="info-value" id="infoPhone">-</div></div>
        <div class="info-group"><div class="info-label">ìƒë…„ì›”ì¼</div><div class="info-value" id="infoBirth">-</div></div>
        <div class="info-group"><div class="info-label">ì£¼ì†Œ</div><div class="info-value" id="infoAddress">-</div></div>
        <div class="info-group"><div class="info-label">ì‚¬ì›ë²ˆí˜¸</div><div class="info-value" id="infoEmpNumber">-</div></div>
      </div>
      <hr class="section-divider">
      <div class="section-subtitle">ì¡°ì§ ì •ë³´</div>
      <div class="info-grid">
        <div class="info-group"><div class="info-label">ì†Œì† ì‚¬ì—…ì¥</div><div class="info-value" id="infoBusiness">-</div></div>
        <div class="info-group"><div class="info-label">ë¶€ì„œ</div><div class="info-value" id="infoDept">-</div></div>
        <div class="info-group"><div class="info-label">ì§ê¸‰</div><div class="info-value" id="infoPosition">-</div></div>
        <div class="info-group"><div class="info-label">ì§ì±…</div><div class="info-value" id="infoJobTitle">-</div></div>
        <div class="info-group"><div class="info-label">ì…ì‚¬ì¼</div><div class="info-value" id="infoHireDate">-</div></div>
        <div class="info-group"><div class="info-label">ì¬ì§ ê¸°ê°„</div><div class="info-value highlight" id="infoTenure">-</div></div>
        <div class="info-group"><div class="info-label">ë“±ë¡ì¼</div><div class="info-value" id="infoCreated">-</div></div>
      </div>
    </div>
    <div class="tab-content" id="tab-work">
      <div class="section-subtitle">ê·¼ë¬´ ì¡°ê±´</div>
      <div class="info-grid">
        <div class="info-group"><div class="info-label">ê·¼ë¬´ í˜•íƒœ</div><div class="info-value" id="infoWorkType">-</div></div>
        <div class="info-group"><div class="info-label">ê·¼ë¬´ ì‹œê°„</div><div class="info-value" id="infoWorkHours">-</div></div>
        <div class="info-group"><div class="info-label">íœ´ê²Œ ì‹œê°„</div><div class="info-value" id="infoBreakTime">-</div></div>
        <div class="info-group"><div class="info-label">ì£¼íœ´ì¼</div><div class="info-value" id="infoWeeklyHoliday">-</div></div>
        <div class="info-group"><div class="info-label">ê·¼ë¬´ì§€</div><div class="info-value" id="infoWorkLocation">-</div></div>
        <div class="info-group"><div class="info-label">ìˆ˜ìŠµ ê¸°ê°„</div><div class="info-value" id="infoProbation">-</div></div>
      </div>
      <hr class="section-divider">
      <div class="section-subtitle">ê³„ì•½ ê¸°ê°„</div>
      <div class="info-grid">
        <div class="info-group"><div class="info-label">ê³„ì•½ ì‹œì‘ì¼</div><div class="info-value" id="infoContractStart">-</div></div>
        <div class="info-group"><div class="info-label">ê³„ì•½ ì¢…ë£Œì¼</div><div class="info-value" id="infoContractEnd">-</div></div>
      </div>
    </div>
    <div class="tab-content" id="tab-salary">
      <div class="section-subtitle">ê¸‰ì—¬ ì •ë³´</div>
      <div class="info-grid">
        <div class="info-group"><div class="info-label">ê¸‰ì—¬ ìœ í˜•</div><div class="info-value" id="infoSalaryType">-</div></div>
        <div class="info-group"><div class="info-label">ê¸°ë³¸ê¸‰</div><div class="info-value highlight" id="infoBaseSalary">-</div></div>
        <div class="info-group"><div class="info-label">ì›”ê¸‰</div><div class="info-value highlight" id="infoMonthlyWage">-</div></div>
        <div class="info-group"><div class="info-label">ì—°ë´‰</div><div class="info-value highlight" id="infoAnnualSalary">-</div></div>
      </div>
      <hr class="section-divider">
      <div class="section-subtitle">ê³„ì¢Œ ì •ë³´</div>
      <div class="info-grid">
        <div class="info-group"><div class="info-label">ì€í–‰ëª…</div><div class="info-value" id="infoBankName">-</div></div>
        <div class="info-group"><div class="info-label">ê³„ì¢Œë²ˆí˜¸</div><div class="info-value" id="infoAccountNumber">-</div></div>
      </div>
    </div>
    <div class="tab-content" id="tab-contract">
      <div class="section-subtitle">ì „ìê³„ì•½ ì´ë ¥</div>
      <ul class="contract-list" id="contractList"><li style="text-align:center;color:#999;padding:40px">ê³„ì•½ ì´ë ¥ì´ ì—†ìŠµë‹ˆë‹¤</li></ul>
    </div>
  </div>
</div>

<!-- í†µí•© ì •ë³´ ìˆ˜ì • ëª¨ë‹¬ -->
<div class="modal-overlay" id="editModal" onclick="closeModalOnBg(event)">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">âœï¸ ì§ì› ì •ë³´ ìˆ˜ì •</div>
      <button class="modal-close" onclick="closeEditModal()">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-section">
        <div class="form-section-title">ì¡°ì§ ë°°ì¹˜</div>
        <div class="form-row">
          <div class="form-group">
            <label>ì†Œì† ì‚¬ì—…ì¥</label>
            <select id="editBusiness"><option value="">ë¯¸ë°°ì •</option></select>
          </div>
          <div class="form-group">
            <label>ì¬ì§ ìƒíƒœ</label>
            <select id="editStatus">
              <option value="active">ì¬ì§ì¤‘</option>
              <option value="on_leave">íœ´ì§</option>
              <option value="resigned">í‡´ì‚¬</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>ë¶€ì„œ</label><input type="text" id="editDept" placeholder="ì˜ˆ: í™€, ì£¼ë°©, ì¹´ìš´í„°"></div>
          <div class="form-group"><label>ì§ê¸‰</label><input type="text" id="editPosition" placeholder="ì˜ˆ: ì‚¬ì›, ì£¼ì„, ë§¤ë‹ˆì €"></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label>ì§ì±…</label><input type="text" id="editJobTitle" placeholder="ì˜ˆ: í™€ ë§¤ë‹ˆì €, ì£¼ë°©ì¥"></div>
          <div class="form-group"><label>ì…ì‚¬ì¼</label><input type="date" id="editHireDate"></div>
        </div>
      </div>
      <div class="form-section">
        <div class="form-section-title">ì¸ì  ì‚¬í•­</div>
        <div class="form-row">
          <div class="form-group"><label>ì´ë¦„</label><input type="text" id="editName"></div>
          <div class="form-group"><label>ì „í™”ë²ˆí˜¸</label><input type="tel" id="editPhone" placeholder="010-0000-0000"></div>
        </div>
        <div class="form-row full">
          <div class="form-group"><label>ì´ë©”ì¼</label><input type="email" id="editEmail"></div>
        </div>
      </div>
      <div class="form-section">
        <div class="form-section-title">ê¸‰ì—¬ ì •ë³´</div>
        <div class="form-row">
          <div class="form-group">
            <label>ê¸‰ì—¬ ìœ í˜•</label>
            <select id="editSalaryType">
              <option value="hourly">ì‹œê¸‰ì œ</option>
              <option value="daily">ì¼ê¸‰ì œ</option>
              <option value="monthly">ì›”ê¸‰ì œ</option>
              <option value="annual">ì—°ë´‰ì œ</option>
            </select>
          </div>
          <div class="form-group"><label>ê¸°ë³¸ê¸‰ (ì›)</label><input type="number" id="editBaseSalary" min="0"></div>
        </div>
      </div>
      <div class="form-section">
        <div class="form-section-title">ê³„ì¢Œ ì •ë³´</div>
        <div class="form-row">
          <div class="form-group">
            <label>ì€í–‰ëª…</label>
            <select id="editBankName">
              <option value="">ì„ íƒ</option>
              <option>KBêµ­ë¯¼ì€í–‰</option><option>ì‹ í•œì€í–‰</option><option>ìš°ë¦¬ì€í–‰</option>
              <option>í•˜ë‚˜ì€í–‰</option><option>IBKê¸°ì—…ì€í–‰</option><option>NHë†í˜‘ì€í–‰</option>
              <option>ì¹´ì¹´ì˜¤ë±…í¬</option><option>í† ìŠ¤ë±…í¬</option><option>ì¼€ì´ë±…í¬</option>
              <option>SCì œì¼ì€í–‰</option><option>ì”¨í‹°ì€í–‰</option><option>ìš°ì²´êµ­</option>
              <option>ìƒˆë§ˆì„ê¸ˆê³ </option><option>ì‹ í˜‘</option><option>ìˆ˜í˜‘ì€í–‰</option>
              <option>ëŒ€êµ¬ì€í–‰</option><option>ë¶€ì‚°ì€í–‰</option><option>ê´‘ì£¼ì€í–‰</option>
              <option>ì „ë¶ì€í–‰</option><option>ê²½ë‚¨ì€í–‰</option><option>ì œì£¼ì€í–‰</option>
            </select>
          </div>
          <div class="form-group"><label>ê³„ì¢Œë²ˆí˜¸</label><input type="text" id="editAccountNumber" placeholder="ìˆ«ìë§Œ ì…ë ¥"></div>
        </div>
      </div>
    </div>
    <div id="saveResult" class="save-result"></div>
    <div class="modal-footer">
      <button class="btn-cancel" onclick="closeEditModal()">ì·¨ì†Œ</button>
      <button class="btn-save" id="saveBtn" onclick="saveEmployee()">ğŸ’¾ ì €ì¥</button>
    </div>
  </div>
</div>

<script>
var authToken=null, employeeData=null, businessList=[];

window.addEventListener('DOMContentLoaded', async function(){
  authToken=localStorage.getItem('authToken');
  if(!authToken){window.location.href='/login.html';return;}
  var p=new URLSearchParams(window.location.search);
  var id=p.get('id');
  if(!id){window.location.href='/employees.html';return;}
  await Promise.all([loadEmployeeDetail(id), loadBusinessList()]);
});

async function loadBusinessList(){
  try{
    var r=await fetch('/.netlify/functions/businesses-list',{headers:{'Authorization':'Bearer '+authToken}});
    var res=await r.json();
    if(res.success && res.businesses){
      businessList=res.businesses;
      var sel=document.getElementById('editBusiness');
      res.businesses.forEach(function(b){
        var opt=document.createElement('option');
        opt.value=b.id;
        opt.textContent=b.name+(b.is_headquarters?' (ë³¸ì )':'');
        sel.appendChild(opt);
      });
    }
  }catch(e){console.error('ì‚¬ì—…ì¥ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:',e);}
}

async function loadEmployeeDetail(id){
  try{
    var r=await fetch('/.netlify/functions/employee-detail?id='+id,{headers:{'Authorization':'Bearer '+authToken}});
    var data=await r.json();
    if(!data.success) throw new Error(data.error);
    employeeData=data.data;
    renderDetail();
    document.getElementById('loadingState').style.display='none';
    document.getElementById('mainContent').style.display='block';
  }catch(e){
    alert('ì§ì› ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: '+e.message);
    window.location.href='/employees.html';
  }
}

function renderDetail(){
  var d=employeeData, name=d.name||'ì´ë¦„ ì—†ìŒ';
  document.title=name+' - StaffManager';
  document.getElementById('breadcrumbName').textContent=name;
  document.getElementById('avatar').textContent=name.charAt(0);
  document.getElementById('empName').textContent=name;
  document.getElementById('empDept').textContent=d.department?'ğŸ¢ '+d.department:'';
  document.getElementById('empPosition').textContent=d.position?'ğŸ“‹ '+d.position:'';
  var bizName=getBizName(d.businessId);
  document.getElementById('empBiz').textContent=bizName?'ğŸ“ '+bizName:'';
  setText('infoBusiness',bizName||'ë¯¸ë°°ì •');
  var se=document.getElementById('empStatus');
  var sm={active:['ì¬ì§ ì¤‘','status-active'],on_leave:['íœ´ì§','status-on_leave'],resigned:['í‡´ì‚¬','status-resigned']};
  var st=sm[d.status]||[d.status,'status-active'];
  se.textContent=st[0]; se.className='status-badge '+st[1];
  setText('infoName',name); setText('infoEmail',d.email); setText('infoPhone',d.phone);
  setText('infoBirth',fmtDate(d.birthDate)); setText('infoAddress',d.address);
  setText('infoEmpNumber',d.employeeNumber); setText('infoDept',d.department);
  setText('infoPosition',d.position); setText('infoJobTitle',d.jobTitle);
  setText('infoHireDate',fmtDate(d.hireDate)); setText('infoCreated',fmtDate(d.createdAt));
  if(d.hireDate){
    var h=new Date(d.hireDate),n=new Date(),df=n-h;
    var y=Math.floor(df/(365.25*864e5)),m=Math.floor((df%(365.25*864e5))/(30.44*864e5));
    setText('infoTenure',(y>0?y+'ë…„ ':'')+m+'ê°œì›”');
  }
  var wm={full_time:'ì •ê·œì§',part_time:'íŒŒíŠ¸íƒ€ì„',contract:'ê³„ì•½ì§',daily:'ì¼ìš©ì§'};
  setText('infoWorkType',wm[d.workType]||d.workType);
  if(d.workStartTime&&d.workEndTime) setText('infoWorkHours',d.workStartTime+' ~ '+d.workEndTime);
  setText('infoBreakTime',d.breakTimeMinutes?d.breakTimeMinutes+'ë¶„':null);
  setText('infoWeeklyHoliday',d.weeklyHoliday); setText('infoWorkLocation',d.workLocation);
  setText('infoProbation',d.probationMonths?d.probationMonths+'ê°œì›”':'ì—†ìŒ');
  setText('infoContractStart',fmtDate(d.contractStartDate));
  setText('infoContractEnd',fmtDate(d.contractEndDate)||'ë¬´ê¸°í•œ');
  var stm={monthly:'ì›”ê¸‰ì œ',hourly:'ì‹œê¸‰ì œ',daily:'ì¼ê¸‰ì œ',annual:'ì—°ë´‰ì œ'};
  setText('infoSalaryType',stm[d.salaryType]||d.salaryType);
  setText('infoBaseSalary',fmtCur(d.baseSalary)); setText('infoMonthlyWage',fmtCur(d.monthlyWage));
  setText('infoAnnualSalary',fmtCur(d.annualSalary)); setText('infoBankName',d.bankName);
  setText('infoAccountNumber',d.accountNumber?maskAcc(d.accountNumber):null);
  renderContracts(d.contracts||[]);
}

function openEditModal(){
  var d=employeeData;
  document.getElementById('editBusiness').value=d.businessId||'';
  document.getElementById('editStatus').value=d.status||'active';
  document.getElementById('editDept').value=d.department||'';
  document.getElementById('editPosition').value=d.position||'';
  document.getElementById('editJobTitle').value=d.jobTitle||'';
  document.getElementById('editHireDate').value=d.hireDate?d.hireDate.split('T')[0]:'';
  document.getElementById('editName').value=d.name||'';
  document.getElementById('editPhone').value=d.phone||'';
  document.getElementById('editEmail').value=d.email||'';
  document.getElementById('editSalaryType').value=d.salaryType||'hourly';
  document.getElementById('editBaseSalary').value=d.baseSalary||'';
  document.getElementById('editBankName').value=d.bankName||'';
  document.getElementById('editAccountNumber').value=d.accountNumber||'';
  document.getElementById('saveResult').className='save-result';
  document.getElementById('saveResult').textContent='';
  document.getElementById('saveBtn').disabled=false;
  document.getElementById('saveBtn').textContent='ğŸ’¾ ì €ì¥';
  document.getElementById('editModal').classList.add('show');
}

function closeEditModal(){document.getElementById('editModal').classList.remove('show');}
function closeModalOnBg(e){if(e.target===document.getElementById('editModal')) closeEditModal();}

async function saveEmployee(){
  var btn=document.getElementById('saveBtn');
  var resultEl=document.getElementById('saveResult');
  btn.disabled=true; btn.textContent='ì €ì¥ ì¤‘...';
  resultEl.className='save-result';
  var payload={
    employeeId:employeeData.id,
    businessId:document.getElementById('editBusiness').value||null,
    status:document.getElementById('editStatus').value,
    department:document.getElementById('editDept').value.trim(),
    position:document.getElementById('editPosition').value.trim(),
    jobTitle:document.getElementById('editJobTitle').value.trim(),
    hireDate:document.getElementById('editHireDate').value||null,
    name:document.getElementById('editName').value.trim(),
    phone:document.getElementById('editPhone').value.trim(),
    email:document.getElementById('editEmail').value.trim(),
    salaryType:document.getElementById('editSalaryType').value,
    baseSalary:parseFloat(document.getElementById('editBaseSalary').value)||null,
    bankName:document.getElementById('editBankName').value,
    accountNumber:document.getElementById('editAccountNumber').value.trim()
  };
  try{
    var r=await fetch('/.netlify/functions/employees-update',{
      method:'PUT',
      headers:{'Authorization':'Bearer '+authToken,'Content-Type':'application/json'},
      body:JSON.stringify(payload)
    });
    var res=await r.json();
    if(!res.success) throw new Error(res.error||res.message||'ì €ì¥ ì‹¤íŒ¨');
    Object.assign(employeeData,payload);
    renderDetail();
    resultEl.textContent='âœ… ì €ì¥ ì™„ë£Œ!';
    resultEl.className='save-result success';
    btn.textContent='ğŸ’¾ ì €ì¥'; btn.disabled=false;
    setTimeout(closeEditModal,1500);
  }catch(e){
    resultEl.textContent='âŒ '+e.message;
    resultEl.className='save-result error';
    btn.textContent='ğŸ’¾ ì €ì¥'; btn.disabled=false;
  }
}

function getBizName(bizId){
  if(!bizId) return null;
  var b=businessList.find(function(x){return x.id===bizId;});
  return b?b.name:null;
}

function renderContracts(cs){
  var l=document.getElementById('contractList');
  if(!cs.length) return;
  var tm={standard_labor:'í‘œì¤€ ê·¼ë¡œê³„ì•½ì„œ',part_time:'ë‹¨ì‹œê°„ ê·¼ë¡œê³„ì•½ì„œ',daily:'ì¼ìš© ê·¼ë¡œê³„ì•½ì„œ'};
  var sm={completed:['ì„œëª… ì™„ë£Œ','contract-signed'],sent:['ë°œì†¡ë¨','contract-sent'],pending:['ëŒ€ê¸° ì¤‘','contract-pending'],viewed:['ì—´ëŒí•¨','contract-sent']};
  l.innerHTML=cs.map(function(c){
    var s=sm[c.status]||[c.status,'contract-pending'];
    return '<li class="contract-item"><div><div class="contract-type">'+(tm[c.type]||c.type||'ê·¼ë¡œê³„ì•½ì„œ')+'</div><div class="contract-date">ìƒì„±: '+fmtDate(c.createdAt)+(c.signedAt?' Â· ì„œëª…: '+fmtDate(c.signedAt):'')+'</div></div><span class="contract-status '+s[1]+'">'+s[0]+'</span></li>';
  }).join('');
}

function switchTab(t){
  document.querySelectorAll('.tab').forEach(function(e){e.classList.remove('active');});
  document.querySelectorAll('.tab-content').forEach(function(e){e.classList.remove('active');});
  document.querySelector('.tab[data-tab="'+t+'"]').classList.add('active');
  document.getElementById('tab-'+t).classList.add('active');
}
function setText(id,v){var e=document.getElementById(id);if(e) e.textContent=v||'-';}
function fmtDate(s){if(!s) return null;var d=new Date(s);if(isNaN(d)) return s;return d.toLocaleDateString('ko-KR',{year:'numeric',month:'2-digit',day:'2-digit'});}
function fmtCur(a){if(!a&&a!==0) return null;return 'â‚©'+Number(a).toLocaleString('ko-KR');}
function maskAcc(a){if(!a||a.length<5) return a;return a.slice(0,3)+'****'+a.slice(-3);}
</script>
</body>
</html>