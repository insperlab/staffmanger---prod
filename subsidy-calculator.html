
Subsidy calculator Â· HTML
ë³µì‚¬

<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì •ë¶€ì§€ì›ê¸ˆ ê³„ì‚°ê¸° - StaffManager</title>
<style>
  :root {
    --blue: #2156D0; --blue-light: #EEF2FF;
    --green: #16A34A; --green-light: #F0FDF4;
    --red: #DC2626; --red-light: #FEF2F2;
    --orange: #EA580C; --orange-light: #FFF7ED;
    --purple: #7C3AED; --purple-light: #F5F3FF;
    --gray: #6B7280; --border: #E5E7EB;
    --dark: #111827;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: 'Pretendard', -apple-system, sans-serif; background: #F9FAFB; color: var(--dark); }

  .navbar { background: white; border-bottom: 1px solid var(--border); padding: 0 24px; height: 56px; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 100; }
  .navbar-brand { font-size: 18px; font-weight: 700; color: var(--blue); text-decoration: none; }
  .navbar-back { font-size: 14px; color: var(--gray); text-decoration: none; }
  .navbar-back:hover { color: var(--blue); }

  .container { max-width: 1080px; margin: 0 auto; padding: 32px 24px; }
  h1 { font-size: 22px; font-weight: 700; margin-bottom: 4px; }
  .subtitle { color: var(--gray); font-size: 14px; margin-bottom: 24px; }

  /* ìš”ì•½ ì¹´ë“œ */
  .summary-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px; margin-bottom: 24px; }
  .summary-card { background: white; border-radius: 12px; border: 1px solid var(--border); padding: 18px; }
  .summary-card .label { font-size: 12px; color: var(--gray); margin-bottom: 6px; }
  .summary-card .value { font-size: 20px; font-weight: 700; }
  .summary-card.green .value { color: var(--green); }
  .summary-card.blue .value { color: var(--blue); }
  .summary-card.orange .value { color: var(--orange); }

  /* ì¡°ê±´ ë°•ìŠ¤ */
  .condition-box { background: var(--blue-light); border: 1px solid #C7D7FA; border-radius: 12px; padding: 14px 18px; margin-bottom: 16px; }
  .condition-box h3 { font-size: 13px; font-weight: 600; color: var(--blue); margin-bottom: 8px; }
  .condition-list { display: flex; gap: 14px; flex-wrap: wrap; }
  .condition-item { font-size: 13px; color: var(--dark); display: flex; align-items: center; gap: 5px; }
  .condition-item::before { content: 'âœ“'; color: var(--green); font-weight: 700; }

  /* ê³ ìš©í˜•íƒœ ë²”ë¡€ */
  .legend-box { background: white; border: 1px solid var(--border); border-radius: 12px; padding: 14px 18px; margin-bottom: 20px; }
  .legend-box h3 { font-size: 13px; font-weight: 600; margin-bottom: 10px; }
  .legend-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px; }
  .legend-item { font-size: 11px; padding: 9px 10px; border-radius: 8px; border: 1px solid var(--border); }
  .legend-item .lt { font-weight: 600; color: var(--blue); margin-bottom: 2px; font-size: 12px; }
  .legend-item .lf { color: var(--gray); line-height: 1.4; }
  .legend-item.excl { border-color: #FCA5A5; background: var(--red-light); }
  .legend-item.excl .lt { color: var(--red); }

  /* ê²½ê³  */
  .warning-box { background: var(--orange-light); border: 1px solid #FED7AA; border-radius: 10px; padding: 12px 16px; margin-bottom: 18px; font-size: 13px; color: #9A3412; display: none; }
  .warning-box.show { display: flex; gap: 8px; }

  /* íƒ­ */
  .tabs { display: flex; border-bottom: 2px solid var(--border); margin-bottom: 20px; }
  .tab { padding: 10px 20px; font-size: 14px; font-weight: 500; color: var(--gray); cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px; }
  .tab.active { color: var(--blue); border-bottom-color: var(--blue); font-weight: 600; }

  /* í…Œì´ë¸” */
  .table-wrap { background: white; border-radius: 12px; border: 1px solid var(--border); overflow: hidden; margin-bottom: 20px; }
  .table-header { padding: 14px 18px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
  .table-header h2 { font-size: 15px; font-weight: 600; }
  .badge { font-size: 11px; font-weight: 600; padding: 2px 8px; border-radius: 20px; white-space: nowrap; }
  .badge-green  { background: var(--green-light);  color: var(--green); }
  .badge-red    { background: var(--red-light);    color: var(--red); }
  .badge-gray   { background: #F3F4F6;             color: var(--gray); }
  .badge-blue   { background: var(--blue-light);   color: var(--blue); }
  .badge-purple { background: var(--purple-light); color: var(--purple); }
  .badge-orange { background: var(--orange-light); color: var(--orange); }
  table { width: 100%; border-collapse: collapse; }
  th { background: #F9FAFB; font-size: 11px; font-weight: 600; color: var(--gray); padding: 9px 14px; text-align: left; border-bottom: 1px solid var(--border); white-space: nowrap; }
  td { padding: 11px 14px; font-size: 13px; border-bottom: 1px solid var(--border); vertical-align: top; }
  tr:last-child td { border-bottom: none; }
  tr:hover td { background: #FAFAFA; }
  .amount { font-weight: 600; }
  .amount.green { color: var(--green); }
  .amount.gray  { color: var(--gray); font-weight: 400; }
  .sub { font-size: 11px; color: var(--gray); margin-top: 2px; line-height: 1.4; }

  /* ì‹ ì²­ ì•ˆë‚´ */
  .guide-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
  .guide-card { background: white; border-radius: 12px; border: 1px solid var(--border); padding: 18px 20px; }
  .guide-card h3 { font-size: 14px; font-weight: 600; margin-bottom: 10px; }
  .guide-card li, .guide-card p { font-size: 13px; color: var(--gray); line-height: 1.7; }
  .guide-card ul { padding-left: 16px; }
  .btn-link { display: inline-flex; align-items: center; background: var(--blue); color: white; text-decoration: none; padding: 8px 14px; border-radius: 8px; font-size: 13px; font-weight: 600; margin-top: 12px; }
  .btn-link:hover { background: #1a45b0; }

  .loading { text-align: center; padding: 48px; color: var(--gray); font-size: 14px; }
  .spinner { width: 28px; height: 28px; border: 3px solid var(--border); border-top-color: var(--blue); border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 12px; }
  @keyframes spin { to { transform: rotate(360deg); } }

  @media (max-width: 768px) {
    .summary-grid { grid-template-columns: 1fr 1fr; }
    .legend-grid { grid-template-columns: 1fr 1fr 1fr; }
    .guide-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>

<nav class="navbar">
  <a href="dashboard.html" class="navbar-brand">StaffManager</a>
  <a href="dashboard.html" class="navbar-back">â† ëŒ€ì‹œë³´ë“œ</a>
</nav>

<div class="container">
  <h1>ğŸ›ï¸ ì •ë¶€ì§€ì›ê¸ˆ ìë™ê³„ì‚°ê¸°</h1>
  <p class="subtitle">ë‘ë£¨ëˆ„ë¦¬ ì‚¬íšŒë³´í—˜ë£Œ ì§€ì› ëŒ€ìƒì„ ê³ ìš©í˜•íƒœë³„ë¡œ ìë™ íŒë³„í•˜ê³  ì›” ì ˆê°ì•¡ì„ ê³„ì‚°í•©ë‹ˆë‹¤. (2026ë…„ ê¸°ì¤€)</p>

  <div class="condition-box">
    <h3>ğŸ“‹ 2026ë…„ ë‘ë£¨ëˆ„ë¦¬ ì§€ì› ìš”ê±´ â€” êµ­ë¯¼ì—°ê¸ˆ(4.75%) + ê³ ìš©ë³´í—˜(0.9%) ê° 80%</h3>
    <div class="condition-list">
      <span class="condition-item">10ì¸ ë¯¸ë§Œ ì‚¬ì—…ì¥</span>
      <span class="condition-item">ì›”í‰ê· ë³´ìˆ˜ 270ë§Œì› ë¯¸ë§Œ</span>
      <span class="condition-item">ì‹ ê·œ ê°€ì…ì (ê³¼ê±° 12ê°œì›” ë¯¸ê°€ì…)</span>
      <span class="condition-item">ìµœëŒ€ 36ê°œì›” ì§€ì›</span>
    </div>
  </div>

  <!-- ê³ ìš©í˜•íƒœë³„ ì›”ë³´ìˆ˜ ì‚°ì • ë°©ì‹ ì•ˆë‚´ -->
  <div class="legend-box">
    <h3>âš™ï¸ ê³ ìš©í˜•íƒœë³„ ë‘ë£¨ëˆ„ë¦¬ ì›”ë³´ìˆ˜ ì‚°ì • ë°©ì‹</h3>
    <div class="legend-grid">
      <div class="legend-item">
        <div class="lt">ì‹œê¸‰ì œ</div>
        <div class="lf">base_salary(ì‹œê¸‰)<br>Ã— ì›” ì†Œì •ê·¼ë¡œì‹œê°„<br><small>ì‹¤ì œ ê³„ì•½ì‹œê°„ ìë™ ê³„ì‚°</small></div>
      </div>
      <div class="legend-item">
        <div class="lt">ì›”ê¸‰ì œ</div>
        <div class="lf">monthly_wage<br>ë˜ëŠ” base_salary<br><small>ë¹„ê³¼ì„¸ìˆ˜ë‹¹ ì œì™¸</small></div>
      </div>
      <div class="legend-item">
        <div class="lt">ì—°ë´‰ì œ</div>
        <div class="lf">annual_salary<br>Ã· 12<br><small>ìƒì—¬ê¸ˆ ë¯¸í¬í•¨ ê¸°ì¤€</small></div>
      </div>
      <div class="legend-item">
        <div class="lt">ì¼ê¸‰ì œ</div>
        <div class="lf">base_salary(ì¼ê¸‰)<br>Ã— ì›” ì†Œì •ê·¼ë¡œì¼ìˆ˜<br><small>work_days ê¸°ë°˜</small></div>
      </div>
      <div class="legend-item">
        <div class="lt">ê¸°ê°„ì œ</div>
        <div class="lf">ì„¤ì • ê¸‰ì—¬ ë°©ì‹<br>ë™ì¼ ì ìš©<br><small>36ê°œì›” ì¹´ìš´íŠ¸</small></div>
      </div>
      <div class="legend-item excl">
        <div class="lt">í”„ë¦¬ëœì„œ</div>
        <div class="lf">âŒ ë¯¸í•´ë‹¹<br><small>4ëŒ€ë³´í—˜ ê°€ì… ëŒ€ìƒ ì•„ë‹˜</small></div>
      </div>
    </div>
  </div>

  <div class="warning-box" id="warningBox">âš ï¸ <span id="warningText"></span></div>

  <div class="summary-grid">
    <div class="summary-card green">
      <div class="label">ì›” ì ˆê° â€” ì‚¬ì—…ì£¼</div>
      <div class="value" id="sumEmployer">...</div>
    </div>
    <div class="summary-card green">
      <div class="label">ì›” ì ˆê° â€” ê·¼ë¡œì í•©</div>
      <div class="value" id="sumEmployee">...</div>
    </div>
    <div class="summary-card blue">
      <div class="label">ì—°ê°„ ì ˆê° í•©ê³„</div>
      <div class="value" id="sumAnnual">...</div>
    </div>
    <div class="summary-card orange">
      <div class="label">ì§€ì› ëŒ€ìƒ / ì „ì²´</div>
      <div class="value" id="sumRatio">...</div>
    </div>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="showTab('eligible')">âœ… ì§€ì› ëŒ€ìƒ</div>
    <div class="tab" onclick="showTab('ineligible')">âŒ ì œì™¸ ì§ì›</div>
    <div class="tab" onclick="showTab('guide')">ğŸ“– ì‹ ì²­ ì•ˆë‚´</div>
  </div>

  <div id="tabEligible">
    <div class="table-wrap">
      <div class="table-header">
        <h2>ë‘ë£¨ëˆ„ë¦¬ ì§€ì› ëŒ€ìƒ ì§ì›</h2>
        <span class="badge badge-green" id="eligibleCount">0ëª…</span>
      </div>
      <div id="eligibleBody"><div class="loading"><div class="spinner"></div>ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div></div>
    </div>
  </div>

  <div id="tabIneligible" style="display:none">
    <div class="table-wrap">
      <div class="table-header">
        <h2>ì§€ì› ì œì™¸ ì§ì›</h2>
        <span class="badge badge-red" id="ineligibleCount">0ëª…</span>
      </div>
      <div id="ineligibleBody"><div class="loading"><div class="spinner"></div></div></div>
    </div>
  </div>

  <div id="tabGuide" style="display:none">
    <div class="guide-grid">
      <div class="guide-card">
        <h3>ğŸ–¥ï¸ ì˜¨ë¼ì¸ ì‹ ì²­</h3>
        <ul>
          <li>4ëŒ€ì‚¬íšŒë³´í—˜ ì •ë³´ì—°ê³„ì„¼í„° ì ‘ì†</li>
          <li>ì‚¬ì—…ì¥ íšŒì› ë¡œê·¸ì¸ í›„ 'ì‚¬ì—…ì¥ì—…ë¬´' í´ë¦­</li>
          <li>'ë‘ë£¨ëˆ„ë¦¬ ì‚¬íšŒë³´í—˜ë£Œ ì§€ì›' ì„ íƒ</li>
          <li>ì§€ì› ëŒ€ìƒ ê·¼ë¡œì ì„ íƒ â†’ ì‹ ì²­ ì™„ë£Œ</li>
        </ul>
        <a href="https://www.4insure.or.kr" target="_blank" class="btn-link">4ëŒ€ë³´í—˜ ì •ë³´ì—°ê³„ì„¼í„° â†’</a>
      </div>
      <div class="guide-card">
        <h3>ğŸ’¡ ì§€ì› ë°©ì‹ & ì£¼ì˜</h3>
        <ul>
          <li>í˜„ê¸ˆ ì§€ê¸‰ âŒ â†’ <strong>ë‹¤ìŒë‹¬ ë³´í—˜ë£Œì—ì„œ ì°¨ê°</strong></li>
          <li>ë‹¹ì›” ë³´í—˜ë£Œ ë²•ì •ê¸°í•œ ë‚´ ë‚©ë¶€ í•„ìˆ˜ (ë¯¸ë‚© ì‹œ ë¯¸ì§€ì›)</li>
          <li>10ì¸ ì´ìƒ ë˜ë©´ ì „ì²´ ì§€ì› ì¤‘ë‹¨</li>
          <li>ì›”ë³´ìˆ˜ 270ë§Œì› ì´ˆê³¼ ì‹œ í•´ë‹¹ ì§ì›ë§Œ ì¤‘ë‹¨</li>
          <li>ì¼ìë¦¬ ì•ˆì •ìê¸ˆ ë“± íƒ€ ì§€ì›ê¸ˆê³¼ ì¤‘ë³µ ë¶ˆê°€</li>
          <li><strong>ì‹ ê·œ ê°€ì…ìë§Œ í•´ë‹¹</strong> (2021ë…„ ì´í›„ ì‹ ì²­ ê¸°ì¤€)</li>
        </ul>
      </div>
      <div class="guide-card">
        <h3>ğŸ“ ë¬¸ì˜ì²˜</h3>
        <ul>
          <li>ê·¼ë¡œë³µì§€ê³µë‹¨ (ê³ ìš©ë³´í—˜): <strong>1588-0075</strong></li>
          <li>êµ­ë¯¼ì—°ê¸ˆê³µë‹¨: <strong>1355</strong></li>
          <li>ê³ ìš©ë³´í—˜ ìƒë‹´: <strong>1350</strong></li>
          <li>4ëŒ€ë³´í—˜ í†µí•©: <a href="https://www.4insure.or.kr" target="_blank">www.4insure.or.kr</a></li>
        </ul>
      </div>
      <div class="guide-card">
        <h3>ğŸ—“ï¸ ì‹ ì²­ ì‹œì </html>
        <ul>
          <li>ì‹ ê·œ ì±„ìš© â†’ <strong>ì±„ìš© ë‹¹ì›”</strong> ì‹ ì²­ ê¶Œì¥</li>
          <li>ê¸°ì¡´ ì§ì› ì†Œê¸‰ ì‹ ì²­ ê°€ëŠ¥ (ë‹¨, ìµœëŒ€ 3ë…„ì¹˜)</li>
          <li>ìŠ¹ì¸ í›„ ìë™ ê°±ì‹  (ì¡°ê±´ ìœ ì§€ ì‹œ)</li>
          <li>ê·¼ë¡œì í‡´ì§ ì‹œ ì§€ì› ìë™ ì¢…ë£Œ</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<script>
// ============================================================
// 2026ë…„ ë‘ë£¨ëˆ„ë¦¬ ê¸°ì¤€ ìƒìˆ˜
// ============================================================
const D = {
  WAGE_LIMIT:      2700000,  // ì›”ë³´ìˆ˜ ìƒí•œ (270ë§Œì› ë¯¸ë§Œ)
  HEADCOUNT_LIMIT: 10,       // ì‚¬ì—…ì¥ ì¸ì› ìƒí•œ (10ì¸ ë¯¸ë§Œ)
  SUPPORT_RATE:    0.80,     // ì§€ì›ìœ¨ 80%
  // 2026ë…„ ë³´í—˜ë£Œìœ¨
  NP_EMP:    0.0475,   // êµ­ë¯¼ì—°ê¸ˆ ê·¼ë¡œì 4.75%
  NP_ER:     0.0475,   // êµ­ë¯¼ì—°ê¸ˆ ì‚¬ì—…ì£¼ 4.75%
  EI_EMP:    0.009,    // ê³ ìš©ë³´í—˜ ê·¼ë¡œì 0.9%
  EI_ER:     0.009,    // ê³ ìš©ë³´í—˜ ì‚¬ì—…ì£¼ ì‹¤ì—…ê¸‰ì—¬ 0.9%
  EI_STAB:   0.0025,   // ê³ ìš©ì•ˆì •ì§ëŠ¥ 150ì¸ ë¯¸ë§Œ 0.25%
  // ê¸°ë³¸ê°’
  DEFAULT_WORK_DAYS_WEEK: 5,   // ì£¼ 5ì¼
  WEEKS_PER_MONTH: 4.345,      // ì›” í‰ê·  ì£¼ìˆ˜
};

// ============================================================
// ì‹¤ì œ work_start_time, work_end_time, break_time_minutes,
// work_days(ì£¼ê°„ ê·¼ë¬´ì¼ìˆ˜) ì»¬ëŸ¼ìœ¼ë¡œ ì›” ì†Œì •ê·¼ë¡œì‹œê°„ ê³„ì‚°
// ============================================================
function calcMonthlyHours(emp) {
  // work_start_time: "09:00", work_end_time: "18:00", break_time_minutes: 60
  const start = emp.work_start_time;  // "HH:MM" í˜•ì‹
  const end   = emp.work_end_time;
  const brk   = Number(emp.break_time_minutes || 60); // ê¸°ë³¸ íœ´ê²Œ 60ë¶„
  const daysPerWeek = emp.work_days
    ? (typeof emp.work_days === 'string'
        ? emp.work_days.split(',').filter(Boolean).length  // "ì›”,í™”,ìˆ˜,ëª©,ê¸ˆ" â†’ 5
        : Number(emp.work_days))
    : D.DEFAULT_WORK_DAYS_WEEK;

  if (start && end) {
    // HH:MM â†’ ë¶„ ë‹¨ìœ„ë¡œ ê³„ì‚°
    const [sh, sm] = start.split(':').map(Number);
    const [eh, em] = end.split(':').map(Number);
    const dailyMinutes = (eh * 60 + em) - (sh * 60 + sm) - brk;
    const dailyHours = Math.max(0, dailyMinutes / 60);
    const monthlyHours = Math.round(dailyHours * daysPerWeek * D.WEEKS_PER_MONTH);
    return { hours: monthlyHours, daily: dailyHours, days: daysPerWeek, method: `${start}~${end} (íœ´ê²Œ${brk}ë¶„), ì£¼${daysPerWeek}ì¼` };
  }

  // work_start/end ë¯¸ì…ë ¥ ì‹œ: work_days ê¸°ë°˜ ê¸°ë³¸ê°’
  const monthlyHours = Math.round(8 * daysPerWeek * D.WEEKS_PER_MONTH);
  return { hours: monthlyHours, daily: 8, days: daysPerWeek, method: `8h Ã— ì£¼${daysPerWeek}ì¼ (ê¸°ë³¸ê°’)` };
}

// ============================================================
// ê³ ìš©í˜•íƒœë³„ ë‘ë£¨ëˆ„ë¦¬ ê¸°ì¤€ ì›”ë³´ìˆ˜ ì‚°ì •
// salary_type ì»¬ëŸ¼ ê°’ ê¸°ì¤€:
//   'hourly'     â†’ ì‹œê¸‰ì œ: base_salary(ì‹œê¸‰) Ã— ì›”ê·¼ë¡œì‹œê°„
//   'monthly'    â†’ ì›”ê¸‰ì œ: monthly_wage ë˜ëŠ” base_salary
//   'annual'     â†’ ì—°ë´‰ì œ: annual_salary Ã· 12
//   'daily'      â†’ ì¼ê¸‰ì œ: base_salary(ì¼ê¸‰) Ã— ì›” ì†Œì •ê·¼ë¡œì¼ìˆ˜
//   'contract'   â†’ ê¸°ê°„ì œ: ì„¤ì • ê¸‰ì—¬ë°©ì‹ê³¼ ë™ì¼
//   'freelancer' â†’ í”„ë¦¬ëœì„œ: ë‘ë£¨ëˆ„ë¦¬ ë¯¸í•´ë‹¹ (4ëŒ€ë³´í—˜ ë¯¸ê°€ì…)
// ============================================================
function calcMonthlySalary(emp) {
  const type = (emp.salary_type || 'monthly').toLowerCase().trim();

  // í”„ë¦¬ëœì„œ â€” ë‘ë£¨ëˆ„ë¦¬ ìì²´ ë¯¸í•´ë‹¹
  if (type === 'freelancer' || type === 'freelance') {
    return { salary: 0, eligible: false, reason: 'í”„ë¦¬ëœì„œ (4ëŒ€ë³´í—˜ ë¯¸ê°€ì…)', typeLabel: 'í”„ë¦¬ëœì„œ' };
  }

  // ì‹œê¸‰ì œ
  if (type === 'hourly') {
    const hourly = Number(emp.base_salary || 0);
    if (!hourly) return { salary: 0, eligible: true, reason: 'ì‹œê¸‰ ë¯¸ì…ë ¥', typeLabel: 'ì‹œê¸‰ì œ', missing: true };
    const wh = calcMonthlyHours(emp);
    const salary = Math.round(hourly * wh.hours);
    return {
      salary, eligible: true, typeLabel: 'ì‹œê¸‰ì œ',
      detail: `${hourly.toLocaleString()}ì›/h Ã— ${wh.hours}h/ì›”`,
      sub: wh.method
    };
  }

  // ì¼ê¸‰ì œ
  if (type === 'daily') {
    const daily = Number(emp.base_salary || 0);
    if (!daily) return { salary: 0, eligible: true, reason: 'ì¼ê¸‰ ë¯¸ì…ë ¥', typeLabel: 'ì¼ê¸‰ì œ', missing: true };
    const wh = calcMonthlyHours(emp);
    const monthlyDays = Math.round(wh.days * D.WEEKS_PER_MONTH);
    const salary = Math.round(daily * monthlyDays);
    return {
      salary, eligible: true, typeLabel: 'ì¼ê¸‰ì œ',
      detail: `${daily.toLocaleString()}ì›/ì¼ Ã— ${monthlyDays}ì¼/ì›”`,
      sub: `ì£¼ ${wh.days}ì¼ ê·¼ë¬´ ê¸°ì¤€`
    };
  }

  // ì—°ë´‰ì œ
  if (type === 'annual') {
    const annual = Number(emp.annual_salary || emp.base_salary || 0);
    if (!annual) return { salary: 0, eligible: true, reason: 'ì—°ë´‰ ë¯¸ì…ë ¥', typeLabel: 'ì—°ë´‰ì œ', missing: true };
    const salary = Math.round(annual / 12);
    return {
      salary, eligible: true, typeLabel: 'ì—°ë´‰ì œ',
      detail: `ì—°ë´‰ ${Math.round(annual/10000)}ë§Œì› Ã· 12`,
      sub: 'ìƒì—¬ê¸ˆ ë¯¸í¬í•¨ ê¸°ì¤€'
    };
  }

  // ê¸°ê°„ì œ â€” ì„¤ì •ëœ ê¸‰ì—¬ ë°©ì‹ê³¼ ë™ì¼í•˜ê²Œ ì²˜ë¦¬
  if (type === 'contract') {
    // ê¸°ê°„ì œëŠ” monthly_wage ë˜ëŠ” base_salary ìš°ì„ 
    const base = Number(emp.monthly_wage || emp.base_salary || 0);
    if (!base) return { salary: 0, eligible: true, reason: 'ê¸‰ì—¬ ë¯¸ì…ë ¥', typeLabel: 'ê¸°ê°„ì œ', missing: true };
    return {
      salary: base, eligible: true, typeLabel: 'ê¸°ê°„ì œ',
      detail: `${base.toLocaleString()}ì›/ì›”`,
      sub: '36ê°œì›” ì¹´ìš´íŠ¸ ì ìš©'
    };
  }

  // ì›”ê¸‰ì œ (ê¸°ë³¸ê°’ â€” monthly í¬í•¨ ëª¨ë“  ë¯¸ì •ì˜ ê°’)
  const monthly = Number(emp.monthly_wage || emp.base_salary || 0);
  if (!monthly) return { salary: 0, eligible: true, reason: 'ê¸°ë³¸ê¸‰ ë¯¸ì…ë ¥', typeLabel: 'ì›”ê¸‰ì œ', missing: true };
  return {
    salary: monthly, eligible: true, typeLabel: 'ì›”ê¸‰ì œ',
    detail: `${monthly.toLocaleString()}ì›/ì›”`,
    sub: emp.monthly_wage && emp.base_salary ? 'ì›”ê¸‰(monthly_wage) ê¸°ì¤€' : ''
  };
}

// ============================================================
// ë‘ë£¨ëˆ„ë¦¬ ì§€ì›ê¸ˆ ê³„ì‚°
// ============================================================
function calcDurunuri(monthlySalary) {
  const R = D.SUPPORT_RATE;
  const np_emp = Math.round(monthlySalary * D.NP_EMP  * R);
  const np_er  = Math.round(monthlySalary * D.NP_ER   * R);
  const ei_emp = Math.round(monthlySalary * D.EI_EMP  * R);
  // ì‚¬ì—…ì£¼: ì‹¤ì—…ê¸‰ì—¬(0.9%) + ê³ ìš©ì•ˆì •(0.25%) í•©ì‚° ì§€ì›
  const ei_er  = Math.round(monthlySalary * (D.EI_ER + D.EI_STAB) * R);
  return {
    np_emp, np_er, ei_emp, ei_er,
    employee: np_emp + ei_emp,   // ê·¼ë¡œì ìˆ˜í˜œì•¡
    employer: np_er  + ei_er,    // ì‚¬ì—…ì£¼ ìˆ˜í˜œì•¡
    total:    np_emp + ei_emp + np_er + ei_er
  };
}

// ì—°ë ¹ ì²´í¬ (êµ­ë¯¼ì—°ê¸ˆ 60ì„¸â†‘ ë©´ì œ, ê³ ìš©ë³´í—˜ 65ì„¸â†‘ ì‹ ê·œ ë©´ì œ)
function getAge(emp) {
  if (!emp.birth_date) return null;
  const now = new Date();
  const b = new Date(emp.birth_date);
  return now.getFullYear() - b.getFullYear()
    - (now < new Date(now.getFullYear(), b.getMonth(), b.getDate()) ? 1 : 0);
}

// ê³ ìš©í˜•íƒœë³„ badge ìƒ‰ìƒ
function typeBadge(type) {
  const map = {
    'hourly':'badge-purple', 'monthly':'badge-blue',
    'annual':'badge-green', 'daily':'badge-orange',
    'contract':'badge-gray', 'freelancer':'badge-red'
  };
  return map[type] || 'badge-gray';
}

function fmt(n) { return Math.round(n).toLocaleString('ko-KR') + 'ì›'; }

// ============================================================
// íƒ­ ì „í™˜
// ============================================================
function showTab(name) {
  ['Eligible','Ineligible','Guide'].forEach(t =>
    document.getElementById('tab'+t).style.display = 'none'
  );
  document.querySelectorAll('.tab').forEach((el, i) =>
    el.classList.toggle('active', ['eligible','ineligible','guide'][i] === name)
  );
  document.getElementById('tab'+ name[0].toUpperCase() + name.slice(1)).style.display = 'block';
}

// ============================================================
// ë©”ì¸ ì‹¤í–‰
// ============================================================
async function loadData() {
  const token = sessionStorage.getItem('authToken');
  if (!token) { location.href = 'login.html'; return; }

  let employees = [];
  try {
    const res = await fetch('/.netlify/functions/employees-list', {
      headers: { 'Authorization': 'Bearer ' + token }
    });
    if (!res.ok) throw new Error('API ' + res.status);
    const json = await res.json();
    employees = json.data || json.employees || json || [];
    if (!Array.isArray(employees)) employees = [];
  } catch (e) {
    document.getElementById('eligibleBody').innerHTML =
      '<div class="loading" style="color:var(--red)">ì§ì› ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨. ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.</div>';
    return;
  }

  // ì¬ì§ ì¤‘ë§Œ í¬í•¨
  const active = employees.filter(e =>
    !['inactive','resigned','í‡´ì§'].includes(e.status)
  );

  // ì¸ì› ê²½ê³  (10ì¸ ì´ìƒ)
  if (active.length >= D.HEADCOUNT_LIMIT) {
    document.getElementById('warningBox').classList.add('show');
    document.getElementById('warningText').textContent =
      `í˜„ì¬ ì¬ì§ ì¸ì› ${active.length}ëª… â€” ë‘ë£¨ëˆ„ë¦¬ëŠ” 10ì¸ ë¯¸ë§Œ ì‚¬ì—…ì¥ë§Œ í•´ë‹¹í•©ë‹ˆë‹¤. ê¸°ì¡´ ì§€ì›ë„ ì¤‘ë‹¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`;
  }

  const eligible = [], ineligible = [];

  active.forEach(emp => {
    const si    = calcMonthlySalary(emp);
    const age   = getAge(emp);
    const excReasons = [];

    if (!si.eligible) {
      excReasons.push(si.reason);
    } else if (si.missing) {
      excReasons.push(si.reason);
    } else if (si.salary >= D.WAGE_LIMIT) {
      excReasons.push(`ì›”ë³´ìˆ˜ ${fmt(si.salary)} â‰¥ 270ë§Œì›`);
    }

    if (excReasons.length === 0) {
      eligible.push({ ...emp, si, age, subsidy: calcDurunuri(si.salary) });
    } else {
      ineligible.push({ ...emp, si, age, reason: excReasons.join(' / ') });
    }
  });

  // ì§‘ê³„
  const totEr  = eligible.reduce((s, e) => s + e.subsidy.employer, 0);
  const totEmp = eligible.reduce((s, e) => s + e.subsidy.employee, 0);

  document.getElementById('sumEmployer').textContent = fmt(totEr)  + '/ì›”';
  document.getElementById('sumEmployee').textContent = fmt(totEmp) + '/ì›”';
  document.getElementById('sumAnnual').textContent   = fmt((totEr + totEmp) * 12) + '/ë…„';
  document.getElementById('sumRatio').textContent    = `${eligible.length} / ${active.length}ëª…`;
  document.getElementById('eligibleCount').textContent   = eligible.length + 'ëª…';
  document.getElementById('ineligibleCount').textContent = ineligible.length + 'ëª…';

  renderEligible(eligible);
  renderIneligible(ineligible);
}

// â”€â”€ ì§€ì› ëŒ€ìƒ í…Œì´ë¸” â”€â”€
function renderEligible(list) {
  if (!list.length) {
    document.getElementById('eligibleBody').innerHTML =
      '<div class="loading" style="color:var(--gray)">ì§€ì› ëŒ€ìƒ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
    return;
  }
  document.getElementById('eligibleBody').innerHTML = `
    <table>
      <thead><tr>
        <th>ì§ì›ëª…</th><th>ê³ ìš©í˜•íƒœ</th><th>ì›”ë³´ìˆ˜</th>
        <th>ê·¼ë¡œì ì ˆê°/ì›”</th><th>ì‚¬ì—…ì£¼ ì ˆê°/ì›”</th>
        <th>í•©ê³„/ì›”</th><th>ì—°ê°„ ì ˆê°</th><th>ë¹„ê³ </th>
      </tr></thead>
      <tbody>
        ${list.map(e => {
          const s = e.subsidy;
          const badges = [];
          if (e.si.typeLabel === 'ê¸°ê°„ì œ') badges.push(`<span class="badge badge-gray">ê¸°ê°„ì œ 36ê°œì›”</span>`);
          if (e.age !== null && e.age >= 60) badges.push(`<span class="badge badge-orange">${e.age}ì„¸ ì—°ê¸ˆë©´ì œ</span>`);
          badges.push('<span class="badge badge-green">ëŒ€ìƒ</span>');
          return `
          <tr>
            <td><strong>${e.name}</strong>
              <div class="sub">${e.department || ''}</div>
            </td>
            <td><span class="badge ${typeBadge(e.salary_type)}">${e.si.typeLabel}</span></td>
            <td>
              <span class="amount">${fmt(e.si.salary)}</span>
              <div class="sub">${e.si.detail || ''}</div>
              ${e.si.sub ? `<div class="sub">${e.si.sub}</div>` : ''}
            </td>
            <td>
              <span class="amount green">${fmt(s.employee)}</span>
              <div class="sub">ì—°ê¸ˆ ${fmt(s.np_emp)} + ê³ ìš© ${fmt(s.ei_emp)}</div>
            </td>
            <td>
              <span class="amount green">${fmt(s.employer)}</span>
              <div class="sub">ì—°ê¸ˆ ${fmt(s.np_er)} + ê³ ìš©+ì•ˆì • ${fmt(s.ei_er)}</div>
            </td>
            <td><span class="amount green">${fmt(s.total)}</span></td>
            <td><span class="amount green">${fmt(s.total * 12)}</span></td>
            <td>${badges.join(' ')}</td>
          </tr>`;
        }).join('')}
      </tbody>
    </table>`;
}

// â”€â”€ ì œì™¸ ì§ì› í…Œì´ë¸” â”€â”€
function renderIneligible(list) {
  if (!list.length) {
    document.getElementById('ineligibleBody').innerHTML =
      '<div class="loading" style="color:var(--green)">ğŸ‰ ëª¨ë“  ì§ì›ì´ ì§€ì› ëŒ€ìƒì…ë‹ˆë‹¤!</div>';
    return;
  }
  document.getElementById('ineligibleBody').innerHTML = `
    <table>
      <thead><tr>
        <th>ì§ì›ëª…</th><th>ê³ ìš©í˜•íƒœ</th><th>ì›”ë³´ìˆ˜</th><th>ì œì™¸ ì‚¬ìœ </th>
      </tr></thead>
      <tbody>
        ${list.map(e => `
        <tr>
          <td><strong>${e.name}</strong></td>
          <td><span class="badge ${typeBadge(e.salary_type)}">${e.si.typeLabel}</span></td>
          <td class="amount ${e.si.salary >= D.WAGE_LIMIT ? 'gray' : ''}">
            ${e.si.salary > 0 ? fmt(e.si.salary) : '-'}
            ${e.si.detail ? `<div class="sub">${e.si.detail}</div>` : ''}
          </td>
          <td><span class="badge badge-red">${e.reason}</span></td>
        </tr>`).join('')}
      </tbody>
    </table>`;
}

// ì‹¤í–‰
loadData();
</script>
</body>
</html>
