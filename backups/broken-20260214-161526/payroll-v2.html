<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸‰ì—¬ ì¡°íšŒ - StaffManager</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px; margin: 0 auto; background: white;
            border-radius: 20px; padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 { color: #333; margin-bottom: 30px; text-align: center; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #555; font-weight: 600; }
        select, input {
            width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;
            font-size: 16px; transition: border-color 0.3s;
        }
        select:focus, input:focus { outline: none; border-color: #667eea; }
        button {
            width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: 600;
            cursor: pointer; transition: transform 0.2s;
        }
        button:hover { transform: translateY(-2px); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .error, .loading { padding: 15px; border-radius: 8px; margin-top: 20px; display: none; }
        .error { background: #fee; color: #c33; }
        .loading { background: #e3f2fd; color: #1976d2; text-align: center; }
        .error.show, .loading.show { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ’° ê¸‰ì—¬ ì¡°íšŒ</h1>
        <div class="form-group">
            <label for="employee">ì§ì› ì„ íƒ</label>
            <select id="employee">
                <option value="">ì§ì›ì„ ì„ íƒí•˜ì„¸ìš”</option>
            </select>
        </div>
        <div class="form-group">
            <label for="year">ë…„ë„</label>
            <input type="number" id="year" min="2020" max="2030" value="2024">
        </div>
        <div class="form-group">
            <label for="month">ì›”</label>
            <select id="month">
                <option value="1">1ì›”</option>
                <option value="2">2ì›”</option>
                <option value="3">3ì›”</option>
                <option value="4">4ì›”</option>
                <option value="5">5ì›”</option>
                <option value="6">6ì›”</option>
                <option value="7">7ì›”</option>
                <option value="8">8ì›”</option>
                <option value="9">9ì›”</option>
                <option value="10">10ì›”</option>
                <option value="11">11ì›”</option>
                <option value="12">12ì›”</option>
            </select>
        </div>
        <button onclick="testAPI()">API í…ŒìŠ¤íŠ¸ (ì§ì› ëª©ë¡ ì¡°íšŒ)</button>
        <div class="loading" id="loading">ì²˜ë¦¬ ì¤‘...</div>
        <div class="error" id="error"></div>
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', async () => {
            console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
            await loadEmployees();
        });

        async function loadEmployees() {
            try {
                showLoading(true);
                hideError();
                
                const userInfo = JSON.parse(localStorage.getItem('userInfo'));
                
                if (!userInfo || !userInfo.companyId) {
                    showError('ë¡œê·¸ì¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    showLoading(false);
                    return;
                }

                console.log('Company ID:', userInfo.companyId);

                const response = await fetch('/.netlify/functions/employees-list', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ companyId: userInfo.companyId })
                });

                console.log('Response status:', response.status);
                console.log('Response OK:', response.ok);

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }

                const data = await response.json();
                console.log('ë°›ì€ ë°ì´í„°:', data);

                const employeeSelect = document.getElementById('employee');
                employeeSelect.innerHTML = '<option value="">ì§ì›ì„ ì„ íƒí•˜ì„¸ìš”</option>';

                if (data.employees && data.employees.length > 0) {
                    data.employees.forEach(emp => {
                        const option = document.createElement('option');
                        option.value = emp.id;
                        option.textContent = `${emp.name} (${emp.phone})`;
                        employeeSelect.appendChild(option);
                    });
                    console.log(`âœ… ${data.employees.length}ëª… ë¡œë“œ ì™„ë£Œ`);
                } else {
                    showError('ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤.');
                }

                showLoading(false);

            } catch (error) {
                console.error('âŒ ì˜¤ë¥˜:', error);
                showError(`ì˜¤ë¥˜: ${error.message}`);
                showLoading(false);
            }
        }

        async function testAPI() {
            console.log('ğŸ§ª API í…ŒìŠ¤íŠ¸ ì‹œì‘');
            await loadEmployees();
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }

        function hideError() {
            document.getElementById('error').classList.remove('show');
        }

        function showLoading(show) {
            const loadingDiv = document.getElementById('loading');
            if (show) loadingDiv.classList.add('show');
            else loadingDiv.classList.remove('show');
        }
    </script>
</body>
</html>
